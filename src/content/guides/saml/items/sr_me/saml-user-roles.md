FastComments мапира SAML корисничке улоге на интерна овлашћења, омогућавајући контролу приступа засновану на улогама за вашу организацију.

### FastComments систем улога

FastComments користи систем дозвола заснован на улогама где корисници могу имати једну или више улога које одређују њихов ниво приступа и могућности.

### Доступне FastComments улоге

#### Административне улоге

**fc-account-owner**
- **Permissions**: Потпуний административни приступ
- **Capabilities**: Све функције, управљање наплатом, управљање корисницима
- **Use Case**: Главни администратори налога и власници

**fc-admin-admin**  
- **Permissions**: Административни приступ већини функција
- **Capabilities**: Управљање корисницима, конфигурација, модерација. **Може управљати другим администраторима.**
- **Use Case**: Споредни администратори и ИТ особље

**fc-billing-admin**
- **Permissions**: Управљање наплатом и претплатама
- **Capabilities**: Начини плаћања, фактуре, промене претплате
- **Use Case**: Чланови финансијског тима и контакти за наплату

#### Специјализоване улоге

**fc-analytics-admin**
- **Permissions**: Приступ аналитикама и извештавању
- **Capabilities**: Преглед статистике сајта, података о ангажовању корисника
- **Use Case**: Маркетиншки тимови и аналитичари података

**fc-api-admin**
- **Permissions**: Приступ и управљање API-јем
- **Capabilities**: API кредитенцијали, конфигурација вебхукова
- **Use Case**: Развијачи и технички интегратори

**fc-moderator**
- **Permissions**: Могућности модерирања коментара
- **Capabilities**: Одобравање/одбијање коментара, управљање спамом
- **Use Case**: Модератори заједнице и менаџери садржаја

### Конфигурација мапирања улога

#### Извори SAML атрибута

FastComments прихвата информације о улогама из различитих SAML имена атрибута како би обезбедио компатибилност са различитим провајдерима идентитета:

**Стандардна имена атрибута**:
- `roles`
- `groups` 
- `memberOf`
- `role`
- `group`

**Microsoft/ADFS атрибути**:
- `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
- `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role`

#### Подржани формати улога

**Array Format** *(Preferred)*:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin</saml:AttributeValue>
    <saml:AttributeValue>fc-moderator</saml:AttributeValue>
</saml:Attribute>
```

**Comma-Separated Format**:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin,fc-moderator</saml:AttributeValue>
</saml:Attribute>
```

**Single Role Format**:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin</saml:AttributeValue>
</saml:Attribute>
```

### Конфигурација улога на провајдеру идентитета

#### Microsoft Azure AD

1. **App Roles Configuration**:
   - Дефинишите FastComments улоге у вашој Azure AD апликацији
   - Доделите кориснике одговарајућим улогама апликације
   - Конфигуришите клеймове да укључују додељене улоге

2. **Attribute Mapping**:
   ```
   Attribute Name: roles
   Source Attribute: user.assignedroles
   ```

#### Okta

1. **Group Assignment**:
   - Креирајте групе које одговарају именима FastComments улога
   - Доделите кориснике одговарајућим групама
   - Конфигуришите изјаве о атрибутима

2. **Attribute Statement**:
   ```
   Name: roles
   Value: user.groups
   Filter: Starts with "fc-"
   ```

#### Google Workspace

1. **Group Mapping**:
   - Креирајте организационе јединице или групе
   - Именујте групе са префиксима FastComments улога
   - Конфигуришите мапирање атрибута

2. **Custom Attributes**:
   ```
   Attribute Name: roles
   Value: Groups or custom schema attribute
   ```

### Подразумевано понашање корисника

#### Корисници без улога

Када SAML корисник нема улоге или има непознате улоге:
- Корисник се креира као стандардни коментатор
- Административни приступ није додељен
- Може да објављује и управља својим коментарима
- Не може да приступи функцијама администраторске контролне табле

#### Наслеђивање улога

- Корисници могу истовремено имати више улога
- Дозволе се акумулирају (примењује се највиши ниво овлашћења)
- Промене улога у IdP-у се одражавају при следећем пријављивању

### Управљање SAML корисницима

#### Креирање корисника

Када се корисник пријави преко SAML-а први пут:
1. **User Account**: Аутоматски се креира налог користећи е-пошту као идентификатор
2. **Role Assignment**: Улоге се примењују на основу SAML атрибута
3. **Profile Information**: Име/презиме се попуњава ако је обезбеђено
4. **Permission Activation**: Улоге постају активне одмах

#### Ажурирања улога

Постојећи SAML корисници примају ажурирања улога:
1. **Login Trigger**: Ажурирања улога се врше при свакој SAML пријави
2. **Immediate Effect**: Нова овлашћења се примењују одмах
3. **Role Removal**: Уклонjene улоге се аутоматски поништавају
4. **Audit Trail**: Промене улога се бележе у ревизорским записима

### Прилагођено мапирање улога

#### Прилагођавање за предузећа

За корпоративне кориснике са специфичним захтевима:
- Прилагођена имена улога могу бити мапирана на FastComments дозволе
- Могуће је имплементирати сложене хијерархије улога
- Могу се конфигурисати контроле приступа по одељењима

Контактирајте FastComments подршку за конфигурације прилагођеног мапирања улога.

#### Валидација улога

FastComments валида у долазне улоге:
- Непознате улоге се игноришу (нису одбијене)
- Неисправно форматирани атрибути улога се бележе за решавање проблема
- Корисници задржавају постојеће улоге ако SAML изјава нема информације о улогама

### Најбоље праксе

#### Управљање улогама

1. **Principle of Least Privilege**: Додељујте минимално потребна овлашћења
2. **Regular Auditing**: Редовно прегледајте корисничке улоге и приступ  
3. **Clear Naming**: Користите описна имена група у вашем провајдеру идентитета
4. **Documentation**: Одржавајте документацију о доделама улога

#### Безбедносни аспекти

1. **Role Attributes**: Осигурате да су атрибути улога правилно заштићени у SAML одговорима
2. **Attribute Validation**: Верификујте да само овлашћени системи могу додељивати улоге
3. **Access Reviews**: Редовно прегледајте доделе административних улога
4. **Monitoring**: Праћење промена улога и административних акција

### Решавање проблема са улогама

#### Чести проблеми

**Roles Not Applied**:
- Проверите да имена SAML атрибута одговарају подржаним форматима
- Верификујте да IdP шаље информације о улогама
- Потврдите да вредности улога тачно одговарају именима FastComments улога

**Access Denied**:
- Проверите да ли кориснику у IdP-у додељена одговарајућа улога
- Проверите правопис и осетљивост на велика/мала слова у имену улоге
- Потврдите да је улога правилно форматирана у SAML одговору

**Missing Permissions**:
- Прегледајте дефиниције улога и неопходна овлашћења
- Проверите конфликтне доделе улога
- Верификујте да се корисник пријавио након промена улога

---