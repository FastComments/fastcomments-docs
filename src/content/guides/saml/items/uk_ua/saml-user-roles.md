FastComments відображає ролі користувачів SAML на внутрішні дозволи, забезпечуючи контроль доступу на основі ролей для вашої організації.

### Система ролей FastComments

FastComments використовує систему дозволів на основі ролей, де користувачі можуть мати одну або кілька ролей, що визначають їхні рівні доступу та можливості.

### Доступні ролі FastComments

#### Адміністративні ролі

**fc-account-owner**
- **Permissions**: Повний адміністративний доступ
- **Capabilities**: Усі функції, управління білінгом, управління користувачами
- **Use Case**: Основні адміністратори та власники облікового запису

**fc-admin-admin**  
- **Permissions**: Адміністративний доступ до більшості функцій
- **Capabilities**: Управління користувачами, конфігурація, модерування. **Може адмініструвати інших адміністраторів.**
- **Use Case**: Вторинні адміністратори та IT-персонал

**fc-billing-admin**
- **Permissions**: Управління білінгом та підписками
- **Capabilities**: Платіжні методи, рахунки-фактури, зміни підписок
- **Use Case**: Члени фінансової команди та контактні особи з білінгу

#### Спеціалізовані ролі

**fc-analytics-admin**
- **Permissions**: Доступ до аналітики та звітності
- **Capabilities**: Перегляд статистики сайту, даних про взаємодію користувачів
- **Use Case**: Маркетингові команди та аналітики даних

**fc-api-admin**
- **Permissions**: Доступ до API та його управління
- **Capabilities**: Облікові дані API, конфігурація вебхуків
- **Use Case**: Розробники та технічні інтегратори

**fc-moderator**
- **Permissions**: Можливості модерації коментарів
- **Capabilities**: Підтвердження/відхилення коментарів, управління спамом
- **Use Case**: Модератори спільноти та контент-менеджери

### Налаштування відображення ролей

#### Джерела атрибутів SAML

FastComments приймає інформацію про ролі з різних імен атрибутів SAML, щоб забезпечити сумісність із різними провайдерами ідентичності:

**Стандартні імена атрибутів**:
- `roles`
- `groups` 
- `memberOf`
- `role`
- `group`

**Атрибути Microsoft/ADFS**:
- `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
- `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role`

#### Підтримувані формати ролей

**Формат масиву** *(рекомендовано)*:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin</saml:AttributeValue>
    <saml:AttributeValue>fc-moderator</saml:AttributeValue>
</saml:Attribute>
```

**Формат з розділенням комами**:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin,fc-moderator</saml:AttributeValue>
</saml:Attribute>
```

**Формат однієї ролі**:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin</saml:AttributeValue>
</saml:Attribute>
```

### Налаштування ролей у провайдера ідентичності

#### Microsoft Azure AD

1. **Налаштування ролей додатка**:
   - Визначте ролі FastComments у вашому додатку Azure AD
   - Призначте користувачів відповідним ролям додатка
   - Налаштуйте claims так, щоб вони включали призначені ролі

2. **Відображення атрибутів**:
   ```
   Attribute Name: roles
   Source Attribute: user.assignedroles
   ```

#### Okta

1. **Призначення груп**:
   - Створіть групи, що відповідають іменам ролей FastComments
   - Призначте користувачів відповідним групам
   - Налаштуйте оператори атрибутів

2. **Заява атрибутів**:
   ```
   Name: roles
   Value: user.groups
   Filter: Starts with "fc-"
   ```

#### Google Workspace

1. **Відображення груп**:
   - Створіть організаційні підрозділи або групи
   - Називайте групи з префіксами ролей FastComments
   - Налаштуйте відображення атрибутів

2. **Користувацькі атрибути**:
   ```
   Attribute Name: roles
   Value: Groups or custom schema attribute
   ```

### Поведінка користувача за замовчуванням

#### Користувачі без ролей

Коли в SAML-користувача відсутні ролі або ролі не розпізнані:
- Користувач створюється як звичайний коментатор
- Адміністративний доступ не надається
- Може публікувати та керувати власними коментарями
- Не може отримати доступ до функцій адміністративної панелі

#### Успадкування ролей

- Користувачі можуть одночасно мати кілька ролей
- Дозволи сумуються (застосовується найвищий рівень дозволів)
- Зміни ролей в IdP відображаються при наступному вході

### Керування SAML-користувачами

#### Створення користувача

Коли користувач вперше входить через SAML:
1. **User Account**: Автоматично створюється обліковий запис з електронною поштою як ідентифікатором
2. **Role Assignment**: Ролі застосовуються на основі атрибутів SAML
3. **Profile Information**: Ім'я/прізвище заповнюються, якщо надані
4. **Permission Activation**: Ролі активуються негайно

#### Оновлення ролей

Існуючі SAML-користувачі отримують оновлення ролей:
1. **Login Trigger**: Оновлення ролей відбуваються під час кожного входу через SAML
2. **Immediate Effect**: Нові дозволи застосовуються негайно
3. **Role Removal**: Видалені ролі відкликаються автоматично
4. **Audit Trail**: Зміни ролей фіксуються в журналах аудиту

### Користувацьке відображення ролей

#### Індивідуальні налаштування для підприємств

Для корпоративних клієнтів з особливими вимогами:
- Імена користувацьких ролей можна зіставляти з дозволами FastComments
- Можна реалізувати складні ієрархії ролей
- Можна налаштувати управління доступом за відділами

Зверніться до служби підтримки FastComments для налаштування користувацького відображення ролей.

#### Валідація ролей

FastComments перевіряє вхідні ролі:
- Нерозпізнані ролі ігноруються (не відхиляються)
- Неправильно сформовані атрибути ролей записуються в логи для усунення неполадок
- Користувачі зберігають існуючі ролі, якщо SAML-утвердження не містить інформації про ролі

### Найкращі практики

#### Управління ролями

1. **Принцип найменших привілеїв**: Призначайте мінімально необхідні дозволи
2. **Регулярний аудит**: Періодично переглядайте ролі користувачів та доступ  
3. **Чітка номенклатура**: Використовуйте описові імена груп у вашому IdP
4. **Документація**: Ведіть документацію призначень ролей

#### Міркування щодо безпеки

1. **Атрибути ролей**: Переконайтеся, що атрибути ролей належним чином захищені в SAML-відповідях
2. **Перевірка атрибутів**: Переконайтеся, що лише авторизовані системи можуть призначати ролі
3. **Перегляди доступу**: Регулярно переглядайте призначення адміністративних ролей
4. **Моніторинг**: Слідкуйте за змінами ролей та адміністративними діями

### Усунення неполадок з ролями

#### Типові проблеми

**Roles Not Applied**:
- Перевірте, що імена атрибутів SAML відповідають підтримуваним форматам
- Переконайтеся, що IdP надсилає інформацію про ролі
- Підтвердіть, що значення ролей точно відповідають іменам ролей FastComments

**Access Denied**:
- Перевірте, чи призначено користувачу відповідну роль в IdP
- Перевірте правопис ролі та чутливість до регістру
- Підтвердіть, що роль правильно сформатована в SAML-відповіді

**Missing Permissions**:
- Перегляньте визначення ролей та необхідні дозволи
- Перевірте на наявність конфліктуючих призначень ролей
- Переконайтеся, що користувач увійшов після змін ролей