Когда SAML включен в FastComments, система автоматически генерирует информацию о Service Provider (SP), которую вам нужно настроить в вашем identity provider.

### Доступ к информации Service Provider

Информация SP отображается на странице конфигурации SAML после включения аутентификации SAML. Эта информация включает все детали, необходимые вашему identity provider для установления доверительных отношений SAML.

### Конечные точки Service Provider

#### SP Entity ID / Audience
**Назначение**: Уникально идентифицирует ваш экземпляр FastComments как поставщика услуг  
**Формат**: `https://fastcomments.com/saml/{your-tenant-id}`  
**Использование**: Настройте это как Entity ID или Audience в вашем IdP

Этот идентификатор гарантирует, что SAML-ответы предназначены для конкретного тенанта FastComments и предотвращает принятие ответов SAML другими инстансами.

#### Assertion Consumer Service (ACS) URL
**Назначение**: Конечная точка, куда ваш IdP отправляет SAML-ответы после аутентификации пользователя  
**Формат**: `https://fastcomments.com/saml/callback/{your-tenant-id}`  
**Использование**: Настройте это как ACS URL или Reply URL в вашем IdP

Это место, куда пользователи перенаправляются после успешной аутентификации у вашего identity provider, вместе с SAML-утверждением, содержащим информацию о пользователе.

#### SP Metadata URL
**Назначение**: Предоставляет полную конфигурацию SAML в стандартном XML-формате  
**Формат**: `https://fastcomments.com/saml/metadata/{your-tenant-id}`  
**Использование**: Некоторые IdP могут автоматически импортировать конфигурацию, используя этот URL

URL метаданных содержит всю необходимую информацию о SP в формате XML, что облегчает автоматическую настройку совместимых identity provider.

#### SAML Login URL
**Назначение**: Прямая ссылка для инициации SAML-аутентификации для вашего тенанта  
**Формат**: `https://fastcomments.com/saml/login/{your-tenant-id}`  
**Использование**: Ссылайте пользователей напрямую на SAML-аутентификацию или тестируйте поток

Вы можете использовать этот URL для тестирования SAML-аутентификации или предоставлять пользователям прямую ссылку для входа через SAML.

### Поддержка SAML Binding

FastComments поддерживает следующие SAML bindings:

#### HTTP-POST Binding
- **Основной метод**: Наиболее распространённый binding для SAML-ответов  
- **Безопасность**: SAML-ответ отправляется через HTTP POST на ACS URL  
- **Использование**: Рекомендуется для продакшен-развёртываний

#### HTTP-Redirect Binding
- **Альтернативный метод**: SAML-ответ отправляется через HTTP redirect  
- **Ограничения**: Ограниченный размер полезной нагрузки из-за ограничений длины URL  
- **Использование**: Поддерживается, но предпочтителен HTTP-POST

### Политика Name ID

FastComments настраивает следующую политику Name ID в SAML-запросах:

- **Формат по умолчанию**: `urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress`  
- **Альтернативные форматы**: Persistent, Transient, Unspecified (настраиваемые)  
- **Требование**: Адрес электронной почты используется как основной идентификатор пользователя

### Атрибуты SAML-запроса

При инициации SAML-аутентификации FastComments отправляет запросы с этими характеристиками:

#### Подпись запроса
- **Статус**: Опционально (настраиваемо)  
- **Алгоритм**: Соответствует настроенному алгоритму подписи  
- **Сертификат**: Используется сертификат, специфичный для тенанта, если подпись запроса включена

#### Запрашиваемые атрибуты
FastComments запрашивает следующие атрибуты в SAML AuthnRequests:

- **Email**: Обязательно для идентификации пользователя  
- **First Name**: Необязательно, для отображения  
- **Last Name**: Необязательно, для отображения  
- **Roles/Groups**: Необязательно, для контроля доступа и прав

### Копирование информации SP

Страница конфигурации SAML предоставляет кликабельные поля, которые автоматически копируют информацию SP в буфер обмена:

1. Нажмите на любое поле информации SP (Entity ID, ACS URL и т.д.)  
2. Значение автоматически копируется в ваш буфер обмена  
3. Вставьте значение в конфигурацию вашего identity provider  
4. Краткое выделение указывает на успешное копирование

Это упрощает точную передачу информации SP в ваш IdP без ошибок ввода.

### Информация о сертификате SP

#### Использование сертификата
- **Назначение**: Шифрует коммуникации и подтверждает личность SP  
- **Ротация**: Сертификаты автоматически управляются FastComments  
- **Доступ**: Публичные сертификаты доступны через URL метаданных

#### Детали сертификата
- **Алгоритм**: RSA-2048 или выше  
- **Срок действия**: Сертификаты автоматически обновляются до истечения срока действия  
- **Распространение**: Доступно через стандартные SAML-метаданные

### Устранение неполадок конфигурации SP

Если ваш identity provider сообщает о проблемах с информацией SP:

1. **Проверьте URL**: Убедитесь, что все URL используют HTTPS и содержат правильный tenant ID  
2. **Проверьте метаданные**: Используйте URL метаданных для проверки конфигурации  
3. **Проверьте подключение**: Убедитесь, что ваш IdP может достичь конечных точек FastComments  
4. **Проверьте формат**: Подтвердите, что ваш IdP поддерживает формат информации SP

Распространённые проблемы включают:
- Неправильный tenant ID в URL  
- Проблемы сетевого подключения между IdP и FastComments  
- IdP ожидает другой формат URL или дополнительные параметры конфигурации