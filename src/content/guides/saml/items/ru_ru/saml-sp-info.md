Когда SAML включен в FastComments, система автоматически генерирует информацию о поставщике услуг (Service Provider, SP), которую необходимо настроить в вашем провайдере удостоверений (IdP).

### Доступ к информации поставщика услуг

Информация SP отображается на странице конфигурации SAML после включения аутентификации SAML. Эта информация включает все данные, необходимые вашему провайдеру удостоверений для установления доверительных отношений SAML.

### Конечные точки поставщика услуг

#### SP Entity ID / Audience
**Назначение**: Уникально идентифицирует ваш экземпляр FastComments как поставщика услуг  
**Формат**: `https://fastcomments.com/saml/{your-tenant-id}`  
**Использование**: Настройте это как Entity ID или Audience в вашем IdP

Этот идентификатор гарантирует, что ответы SAML предназначены для вашего конкретного тенанта FastComments и предотвращает принятие ответов SAML другими инстансами.

#### URL Assertion Consumer Service (ACS)
**Назначение**: Конечная точка, куда ваш IdP отправляет ответы SAML после аутентификации пользователя  
**Формат**: `https://fastcomments.com/saml/callback/{your-tenant-id}`  
**Использование**: Настройте это как ACS URL или Reply URL в вашем IdP

Здесь пользователи перенаправляются после успешной аутентификации у вашего провайдера удостоверений вместе с утверждением SAML, содержащим информацию о пользователе.

#### SP Metadata URL
**Назначение**: Предоставляет полную конфигурацию SAML в стандартном XML-формате  
**Формат**: `https://fastcomments.com/saml/metadata/{your-tenant-id}`  
**Использование**: Некоторые IdP могут автоматически импортировать конфигурацию, используя этот URL

URL метаданных содержит всю необходимую информацию о SP в формате XML, что упрощает автоматическую настройку совместимых провайдеров удостоверений.

#### SAML Login URL
**Назначение**: Прямая ссылка для инициации SAML-аутентификации для вашего тенанта  
**Формат**: `https://fastcomments.com/saml/login/{your-tenant-id}`  
**Использование**: Ссылка для прямого перенаправления пользователей на аутентификацию SAML или для тестирования потока

Вы можете использовать этот URL для тестирования аутентификации SAML или предоставить пользователям прямую ссылку для входа через SAML.

### Поддерживаемые привязки SAML

FastComments поддерживает следующие привязки SAML:

#### Привязка HTTP-POST
- **Основной метод**: Наиболее распространённая привязка для ответов SAML  
- **Безопасность**: Ответ SAML отправляется через HTTP POST на ACS URL  
- **Использование**: Рекомендуется для продуктивных развертываний

#### Привязка HTTP-Redirect
- **Альтернативный метод**: Ответ SAML отправляется через перенаправление HTTP  
- **Ограничения**: Ограниченный размер полезной нагрузки из-за ограничений длины URL  
- **Использование**: Поддерживается, но предпочтительнее HTTP-POST

### Политика Name ID

FastComments настраивает следующую политику Name ID в SAML-запросах:

- **Формат по умолчанию**: `urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress`  
- **Альтернативные форматы**: Persistent, Transient, Unspecified (настраивается)  
- **Требование**: Адрес электронной почты используется в качестве основного идентификатора пользователя

### Атрибуты SAML-запроса

При инициации аутентификации SAML FastComments отправляет запросы со следующими характеристиками:

#### Подпись запроса
- **Статус**: Необязательно (настраивается)  
- **Алгоритм**: Соответствует настроенному алгоритму подписи  
- **Сертификат**: Используется сертификат, специфичный для тенанта, если подпись запроса включена

#### Запрашиваемые атрибуты
FastComments запрашивает следующие атрибуты в SAML AuthnRequests:

- **Email**: Требуется для идентификации пользователя  
- **First Name**: Необязательно для отображения  
- **Last Name**: Необязательно для отображения  
- **Roles/Groups**: Необязательно для управления доступом и правами

### Копирование информации SP

Страница конфигурации SAML предоставляет кликабельные поля, которые автоматически копируют информацию SP в буфер обмена:

1. Нажмите на любое поле с информацией SP (Entity ID, ACS URL и т.д.)  
2. Значение автоматически скопируется в буфер обмена  
3. Вставьте значение в конфигурацию вашего провайдера удостоверений  
4. Краткое подсвечивание указывает на успешное копирование

Это упрощает точную передачу информации SP в ваш IdP без ошибок набора.

### Информация о сертификате SP

#### Использование сертификата
- **Назначение**: Шифрует коммуникации и подтверждает личность SP  
- **Ротация**: Сертификаты управляются автоматически FastComments  
- **Доступ**: Публичные сертификаты доступны через URL метаданных

#### Сведения о сертификате
- **Алгоритм**: RSA-2048 или выше  
- **Срок действия**: Сертификаты автоматически обновляются до истечения срока действия  
- **Распространение**: Доступно через стандартные метаданные SAML

### Устранение неполадок конфигурации SP

Если ваш провайдер удостоверений сообщает о проблемах с информацией SP:

1. **Проверьте URL**: Убедитесь, что все URL используют HTTPS и содержат правильный tenant ID  
2. **Проверьте метаданные**: Используйте URL метаданных для проверки конфигурации  
3. **Проверьте подключение**: Убедитесь, что ваш IdP может достичь конечных точек FastComments  
4. **Проверьте формат**: Подтвердите, что ваш IdP поддерживает формат информации SP

Распространённые проблемы включают:
- Неправильный tenant ID в URL  
- Проблемы сетевой доступности между IdP и FastComments  
- IdP ожидает другой формат URL или дополнительные параметры конфигурации