Αυτός ο οδηγός καλύπτει κοινά προβλήματα πιστοποίησης SAML και τις λύσεις τους.

### Προβλήματα Πιστοποιητικών και Ασφαλείας

#### Σφάλμα Άκυρου Πιστοποιητικού

**Συμπτώματα**:
- Σφάλμα "Certificate validation failed"
- Οι χρήστες δεν μπορούν να ολοκληρώσουν την πιστοποίηση SAML
- Οι απαντήσεις SAML απορρίπτονται

**Κοινές Αιτίες**:
- Το format του πιστοποιητικού είναι λανθασμένο
- Το πιστοποιητικό έχει λήξει
- Παρέχεται λανθασμένο πιστοποιητικό
- Πρόσθετοι χαρακτήρες ή κενά στο πιστοποιητικό

**Λύσεις**:
1. **Επαλήθευση Format Πιστοποιητικού**:
   - Βεβαιωθείτε ότι το πιστοποιητικό περιλαμβάνει τους δείκτες `-----BEGIN CERTIFICATE-----` και `-----END CERTIFICATE-----`
   - Αφαιρέστε τυχόν επιπλέον κενά ή αλλαγές γραμμής
   - Αντιγράψτε το πιστοποιητικό άμεσα από τα μεταδεδομένα ή τη ρύθμιση του IdP

2. **Έλεγχος Ισχύος Πιστοποιητικού**:
   - Επαληθεύστε ότι το πιστοποιητικό δεν έχει λήξει
   - Επιβεβαιώστε ότι το πιστοποιητικό αντιστοιχεί στο σωστό IdP
   - Χρησιμοποιήστε online validators πιστοποιητικών για έλεγχο του format

3. **Επαναλήψη Λήψης Πιστοποιητικού**:
   - Κατεβάστε φρέσκο πιστοποιητικό από το IdP
   - Χρησιμοποιήστε το URL μεταδεδομένων του IdP αν είναι διαθέσιμο
   - Επιβεβαιώστε ότι το πιστοποιητικό ταιριάζει με τη τρέχουσα ρύθμιση του IdP

#### Αποτυχία Επαλήθευσης Υπογραφής

**Συμπτώματα**:
- Σφάλματα επαλήθευσης υπογραφής δήλωσης SAML
- Η πιστοποίηση αποτυγχάνει μετά το login στο IdP
- Μηνύματα σφάλματος "Invalid signature"

**Λύσεις**:
1. **Μη-Συμβατότητα Αλγορίθμου**:
   - Ελέγξτε ότι ο αλγόριθμος υπογραφής στο FastComments ταιριάζει με του IdP
   - Δοκιμάστε διαφορετικούς αλγορίθμους υπογραφής (SHA-256, SHA-1, SHA-512)
   - Επαληθεύστε ότι ο αλγόριθμος digest ταιριάζει με τη ρύθμιση του IdP

2. **Προβλήματα Πιστοποιητικού**:
   - Βεβαιωθείτε ότι έχει ρυθμιστεί το σωστό πιστοποιητικό υπογραφής
   - Επαληθεύστε ότι το πιστοποιητικό αντιστοιχεί στο ιδιωτικό κλειδί που χρησιμοποιεί το IdP
   - Ελέγξτε για περιστροφή πιστοποιητικού στο IdP

### Προβλήματα Διαμόρφωσης

#### Λανθασμένο Entity ID ή ACS URL

**Συμπτώματα**:
- Το IdP αναφέρει "Unknown Service Provider"
- Οι απαντήσεις SAML πηγαίνουν σε λανθασμένο endpoint
- Η πιστοποίηση δεν ολοκληρώνεται

**Λύσεις**:
1. **Επαλήθευση Πληροφοριών SP**:
   - Αντιγράψτε ακριβώς το Entity ID από τη ρύθμιση του FastComments
   - Βεβαιωθείτε ότι το ACS URL ταιριάζει με το format: `https://fastcomments.com/saml/callback/{tenant-id}`
   - Ελέγξτε για ορθογραφικά λάθη στο tenant ID

2. **Διαμόρφωση IdP**:
   - Ενημερώστε το IdP με το σωστό SP Entity ID
   - Διαμορφώστε σωστά το ACS/Reply URL
   - Επαληθεύστε τις ρυθμίσεις binding του IdP (προτιμάται HTTP-POST)

#### Λείπουν ή Λανθασμένα Attributes

**Συμπτώματα**:
- Οι χρήστες δημιουργούνται χωρίς σωστούς ρόλους
- Λείπουν πληροφορίες προφίλ χρήστη
- Σφάλματα "Email required"

**Λύσεις**:
1. **Attribute Email**:
   - Βεβαιωθείτε ότι το IdP στέλνει το attribute email
   - Ελέγξτε το mapping του ονόματος attribute (email, emailAddress, κ.λπ.)
   - Επαληθεύστε ότι η τιμή email είναι έγκυρη διεύθυνση ηλεκτρονικού ταχυδρομείου

2. **Role Attributes**:
   - Επιβεβαιώστε ότι το IdP στέλνει πληροφορίες ρόλων/ομάδων
   - Ελέγξτε ότι τα ονόματα των attribute ρόλων ταιριάζουν με τις προσδοκίες του FastComments
   - Επαληθεύστε ότι οι τιμές των ρόλων ταιριάζουν ακριβώς με τα ονόματα ρόλων του FastComments

3. **Format Attribute**:
   - Δοκιμάστε τόσο μορφές array όσο και comma-separated για ρόλους
   - Βεβαιωθείτε ότι οι τιμές attribute δεν έχουν επιπλέον κενά
   - Ελέγξτε για ευαισθησία σε πεζά/κεφαλαία στα ονόματα ρόλων

### Προβλήματα Ροής Πιστοποίησης

#### Βρόχος Ανακατεύθυνσης

**Συμπτώματα**:
- Ο browser ανακατευθύνει ατελείωτα μεταξύ FastComments και IdP
- Η πιστοποίηση δεν ολοκληρώνεται ποτέ
- Πολλαπλές ανακατευθύνσεις εμφανίζονται στα εργαλεία ανάπτυξης του browser

**Λύσεις**:
1. **Έλεγχος Διαμόρφωσης SP**:
   - Επαληθεύστε ότι το Entity ID ταιριάζει ακριβώς με τη ρύθμιση του IdP
   - Βεβαιωθείτε ότι το ACS URL είναι σωστά ρυθμισμένο στο IdP
   - Ελέγξτε για τελικές κάθετες γραμμές (trailing slashes) στα URLs

2. **Προβλήματα Συνόδου (Session)**:
   - Καθαρίστε τα cookies του browser και δοκιμάστε ξανά
   - Δοκιμάστε σε παράθυρο ανώνυμης/ιδιωτικής περιήγησης
   - Ελέγξτε τις ρυθμίσεις timeout συνεδρίας

#### Πρόσβαση Αρνηθεί Μετά την Πιστοποίηση

**Συμπτώματα**:
- Η πιστοποίηση SAML είναι επιτυχής
- Ο χρήστης ανακατευθύνεται στο FastComments
- Εμφανίζεται "Access denied" ή σφάλμα δικαιωμάτων

**Λύσεις**:
1. **Ανάθεση Ρόλων**:
   - Επαληθεύστε ότι ο χρήστης έχει τους κατάλληλους ρόλους στο IdP
   - Ελέγξτε ότι το attribute ρόλου αποστέλλεται στην απάντηση SAML
   - Επιβεβαιώστε ότι τα ονόματα των ρόλων ταιριάζουν ακριβώς με τις απαιτήσεις του FastComments

2. **Περιορισμοί Πακέτου**:
   - Επαληθεύστε ότι ο λογαριασμός έχει σχέδιο Flex ή Pro
   - Ελέγξτε αν η λειτουργία SAML είναι ενεργοποιημένη για το πακέτο
   - Επικοινωνήστε με την υποστήριξη αν το πακέτο περιλαμβάνει SAML αλλά η δυνατότητα δεν είναι διαθέσιμη

### Προβλήματα Συγκεκριμένων Παρόχων Ταυτότητας

#### Microsoft Azure AD

**Κοινά Προβλήματα**:
- Οι αναθέσεις ρόλων εφαρμογής δεν αντικατοπτρίζονται στα tokens
- Claims δεν αποστέλλονται σωστά
- Απαιτήσεις ανάθεσης χρήστη

**Λύσεις**:
- Ελέγξτε την ανάθεση χρήστη στην εφαρμογή FastComments
- Επαληθεύστε ότι οι ρόλοι της εφαρμογής έχουν ρυθμιστεί σωστά
- Βεβαιωθείτε ότι το mapping των claims περιλαμβάνει τα απαιτούμενα attributes

#### Okta

**Κοινά Προβλήματα**:
- Τα φίλτρα ομάδων δεν λειτουργούν σωστά
- Οι δηλώσεις attributes (attribute statements) ρυθμισμένες λανθασμένα
- Προβλήματα ανάθεσης εφαρμογής

**Λύσεις**:
- Αναθεωρήστε τη ρύθμιση των attribute statements
- Ελέγξτε την ανάθεση ομάδων και τους κανόνες φιλτραρίσματος
- Επαληθεύστε ότι η εφαρμογή έχει ανατεθεί στους κατάλληλους χρήστες/ομάδες

#### Google Workspace

**Κοινά Προβλήματα**:
- Τα custom attributes δεν αντιστοιχίζονται σωστά
- Η συμμετοχή σε ομάδες δεν αποστέλλεται
- Σφάλματα διαμόρφωσης εφαρμογής SAML

**Λύσεις**:
- Διαμορφώστε custom schema για attributes ρόλων
- Ελέγξτε την προώθηση συμμετοχής ομάδων
- Επαληθεύστε το mapping attributes της εφαρμογής SAML

### Δίκτυο και Συνδεσιμότητα

#### Σφάλματα Timeout

**Συμπτώματα**:
- Η διαδικασία πιστοποίησης υπερβαίνει το χρόνο (times out)
- Σφάλματα "Request timeout" ή παρόμοια
- Αργή ροή πιστοποίησης

**Λύσεις**:
1. **Συνδεσιμότητα Δικτύου**:
   - Ελέγξτε ότι οι κανόνες firewall επιτρέπουν επικοινωνία με το FastComments
   - Επαληθεύστε την επίλυση DNS για fastcomments.com
   - Δοκιμάστε τη συνδεσιμότητα δικτύου από το IdP προς το FastComments

2. **Προβλήματα Απόδοσης**:
   - Ελέγξτε τους χρόνους απόκρισης του IdP
   - Επαληθεύστε ότι η επαλήθευση της αλυσίδας πιστοποιητικών δεν είναι αργή
   - Σκεφτείτε τη λανθάνουσα κατάσταση δικτύου (latency) μεταξύ IdP και χρηστών

#### Προβλήματα SSL/TLS

**Συμπτώματα**:
- Προειδοποιήσεις πιστοποιητικών κατά την πιστοποίηση
- Αποτυχίες handshake SSL
- Σφάλματα "Secure connection failed"

**Λύσεις**:
- Βεβαιωθείτε ότι όλα τα SAML endpoints χρησιμοποιούν HTTPS
- Ελέγξτε την ισχύ των πιστοποιητικών για όλα τα εμπλεκόμενα domains
- Επαληθεύστε τη συμβατότητα έκδοσης TLS

### Αποσφαλμάτωση και Καταγραφή

#### Ενεργοποίηση Πληροφοριών Debug

1. **Εργαλεία Ανάπτυξης Browser**:
   - Παρακολουθήστε την καρτέλα Network κατά τη ροή SAML
   - Ελέγξτε την Console για σφάλματα JavaScript
   - Εξετάστε τις αιτήσεις SAML POST (αν είναι ορατές)

2. **Καταγραφή IdP**:
   - Ενεργοποιήστε το debugging SAML στο IdP σας
   - Ανασκοπήστε τα logs του IdP για λεπτομέρειες αιτήσεων/απαντήσεων SAML
   - Ελέγξτε για προβλήματα mapping attributes

#### Κοινά Μηνύματα Καταγραφής

**FastComments Logs**:
- "SAML config not found" - SAML not enabled or misconfigured
- "Invalid certificate" - Certificate validation failed
- "Missing email attribute" - Required email not provided in SAML response

**IdP Logs**:
- "Unknown service provider" - Entity ID mismatch
- "Invalid ACS URL" - Assertion Consumer Service URL incorrect
- "User not assigned" - User lacks access to SAML application

### Λήψη Βοήθειας

#### Πληροφορίες για Συλλογή

Όταν επικοινωνείτε με την υποστήριξη, παρέχετε:
- Ακριβή μηνύματα σφάλματος και χρονικές σφραγίδες (timestamps)
- Λεπτομέρειες διαμόρφωσης SAML (χωρίς ευαίσθητα δεδομένα)
- Τύπο και έκδοση IdP
- Βήματα για την αναπαραγωγή του προβλήματος
- Πληροφορίες browser και δικτύου

#### Υποστήριξη FastComments

Για ζητήματα σχετικά με SAML:
1. Χρησιμοποιήστε το [support portal](https://fastcomments.com/auth/my-account/help)
2. Συμπεριλάβετε το tenant ID και τα επηρεαζόμενα emails χρηστών
3. Παρέχετε τα μηνύματα σφάλματος και λεπτομέρειες διαμόρφωσης
4. Προσδιορίστε τον τύπο IdP και την προσέγγιση διαμόρφωσης

#### Υποστήριξη IdP

Για ζητήματα συγκεκριμένα στον IdP:
- Ανατρέξτε στη τεκμηρίωση του IdP για troubleshooting SAML
- Χρησιμοποιήστε τα κανάλια υποστήριξης του IdP για προβλήματα διαμόρφωσης
- Αξιοποιήστε τα community forums του IdP για κοινά ζητήματα

### Συμβουλές Πρόληψης

#### Καλές Πρακτικές

1. **Δοκιμάστε Ενδελεχώς**:
   - Δοκιμάστε αλλαγές ρύθμισης σε περιβάλλον μη-παραγωγής
   - Επαληθεύστε με πολλούς δοκιμαστικούς χρήστες
   - Τεκμηριώστε τις ρυθμίσεις που λειτουργούν

2. **Παρακολούθηση Τακτικά**:
   - Οργανώστε παρακολούθηση για αποτυχίες πιστοποίησης SAML
   - Ελέγχετε ημερομηνίες λήξης πιστοποιητικών
   - Παρακολουθήστε για αλλαγές ρύθμισης IdP

3. **Τεκμηρίωση**:
   - Διατηρήστε τεκμηρίωση της ρύθμισης SAML
   - Τεκμηριώστε τυχόν προσαρμοσμένες ρυθμίσεις ή λύσεις
   - Διατηρήστε στοιχεία επικοινωνίας των διαχειριστών IdP

#### Προληπτική Συντήρηση

1. **Διαχείριση Πιστοποιητικών**:
   - Παρακολουθείτε τις ημερομηνίες λήξης πιστοποιητικών
   - Σχεδιάστε διαδικασίες περιστροφής (rotation) πιστοποιητικών
   - Δοκιμάστε ενημερώσεις πιστοποιητικών πριν τη λήξη

2. **Ανασκοπήσεις Διαμόρφωσης**:
   - Επανεξετάζετε τακτικά τη ρύθμιση SAML
   - Επαληθεύετε ότι η διαμόρφωση IdP παραμένει επικαιροποιημένη
   - Ενημερώνετε την τεκμηρίωση καθώς γίνονται αλλαγές