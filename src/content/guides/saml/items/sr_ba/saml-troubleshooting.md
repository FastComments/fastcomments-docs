Овај водич обухвата уобичајене проблеме са SAML аутентификацијом и њихова решења.

### Проблеми са сертификатом и безбједношћу

#### Грешка неважећег сертификата

**Симптоми**:
- грешка "Certificate validation failed"
- корисници не могу довршити SAML аутентификацију
- SAML одговори се одбијају

**Уобичајени узроци**:
- формат сертификата је неисправан
- сертификат је истекао
- обезбијеђен је погрешан сертификат
- додатни знакови или размаке у сертификату

**Рјешења**:
1. **Провјерите формат сертификата**:
   - Осигурајте да сертификат садржи `-----BEGIN CERTIFICATE-----` и `-----END CERTIFICATE-----` маркере
   - Уклоните све додатне размаке или прекиде линија
   - Копирајте сертификат директно из IdP метаподатака или конфигурације

2. **Провјерите важење сертификата**:
   - Потврдите да сертификат није истекао
   - Потврдите да је сертификат за исправни IdP
   - Користите онлајн валидаторе сертификата да провјерите формат

3. **Преузмите сертификат поново**:
   - Преузмите свежи сертификат од IdP-а
   - Користите IdP URL метаподатака ако је доступан
   - Потврдите да сертификат одговара тренутној IdP конфигурацији

#### Неуспјех провјере потписа

**Симптоми**:
- грешке валидације потписа SAML изјаве
- аутентификација не успије након IdP пријаве
- поруке о грешци "Invalid signature"

**Рјешења**:
1. **Неслагање алгоритма**:
   - Провјерите да ли алгоритам потписа у FastComments одговара IdP-у
   - Испробајте различите алгоритме потписа (SHA-256, SHA-1, SHA-512)
   - Потврдите да алгоритам дигеста одговара IdP конфигурацији

2. **Проблеми са сертификатом**:
   - Осигурајте да је тачан сертификат за потписивање конфигурисан
   - Провјерите да ли сертификат одговара приватном кључу који користи IdP
   - Проверите да ли је у IdP-у дошло до ротације сертификата

### Проблеми са конфигурацијом

#### Погрешан Entity ID или ACS URL

**Симптоми**:
- IdP пријављује "Unknown Service Provider"
- SAML одговори иду на погрешан крајњи пункт
- аутентикација се не довршава

**Рјешења**:
1. **Провјерите информације о SP-у**:
   - Копирајте тачан Entity ID из FastComments конфигурације
   - Осигурајте да ACS URL одговара формату: `https://fastcomments.com/saml/callback/{tenant-id}`
   - Провјерите има ли типографских грешака у tenant ID-у

2. **IdP конфигурација**:
   - Ажурирајте IdP са исправним SP Entity ID-ем
   - Конфигуришите исправан ACS/Reply URL
   - Провјерите поставке binding-а у IdP-у (HTTP-POST је препоручен)

#### Недостају или су нетачни атрибути

**Симптоми**:
- корисници се креирају без одговарајућих улога
- недостају информације у корисничком профилу
- грешке "Email required"

**Рјешења**:
1. **Атрибут е-поште**:
   - Осигурајте да IdP шаље атрибут е-поште
   - Провјерите мапирање имена атрибута (email, emailAddress, итд.)
   - Потврдите да је вриједност е-поште важећа адреса е-поште

2. **Атрибути улога**:
   - Потврдите да IdP шаље информације о улогама/групама
   - Провјерите да имена атрибута улога одговарају очекивањима FastComments-а
   - Потврдите да вриједности улога тачно одговарају именима улога у FastComments

3. **Формат атрибута**:
   - Тестирајте и низове и формате са вриједностима раздвојеним зарезом за улоге
   - Осигурајте да вриједности атрибута немају додатне размаке
   - Провјерите осјетљивост на велика/мала слова у именима улога

### Проблеми у току аутентикације

#### Петља преусмјеравања

**Симптоми**:
- претраживач се бесконачно преусмјерава између FastComments-а и IdP-а
- аутентикација никада не завршава
- више преусмјеравања видљиво у алатима за развој података у прегледачу

**Рјешења**:
1. **Провјерите конфигурацију SP-а**:
   - Потврдите да Entity ID тачно одговара IdP конфигурацији
   - Осигурајте да је ACS URL правилно конфигурисан у IdP-у
   - Провјерите да ли у URL-овима има завршних косих црта

2. **Проблеми са сесијом**:
   - Обришите колачиће прегледача и покушајте поново
   - Тестирајте у режиму приватног/инкогнито прозора
   - Провјерите поставке таймаута сесије

#### Приступ одбијен након аутентикације

**Симптоми**:
- SAML аутентикација успије
- корисник је преусмјерен на FastComments
- приказује се "Access denied" или грешка о дозволама

**Рјешења**:
1. **Додјела улога**:
   - Провјерите да корисник има одговарајуће улоге у IdP-у
   - Провјерите да ли се атрибут улоге шаље у SAML одговору
   - Потврдите да имена улога тачно одговарају захтјевима FastComments-а

2. **Ограничења пакета**:
   - Провјерите да ли налог има Flex или Pro план
   - Провјерите да ли је SAML функција омогућена за тај пакет
   - Контактирајте подршку ако пакет укључује SAML али функција није доступна

### Проблеми специфични за провајдера идентитета

#### Microsoft Azure AD

**Уобичајени проблеми**:
- додјеле улога апликације се не одражавају у токенима
- захтјеви/claims се не шаљу правилно
- захтјеви за додјелу корисника

**Рјешења**:
- Провјерите додјелу корисника апликацији FastComments
- Потврдите да су улоге апликације исправно конфигурисане
- Осигурајте да мапирање claims укључује потребне атрибуте

#### Okta

**Уобичајени проблеми**:
- филтри група не раде исправно
- изјаве атрибута су погрешно конфигурисане
- проблеми са додјелом апликације

**Рјешења**:
- Прегледајте конфигурацију изјаве атрибута
- Провјерите додјелу група и правила филтрирања
- Потврдите да је апликација додјељена одговарајућим корисницима/групама

#### Google Workspace

**Уобичајени проблеми**:
- прилагођени атрибути се не мапирају исправно
- чланство у групи се не шаље
- грешке у конфигурацији SAML апликације

**Рјешења**:
- Конфигуришите прилагођени шему за атрибуте улога
- Провјерите пропагацију чланства у групама
- Потврдите мапирање атрибута у SAML апликацији

### Мрежни и повезивостни проблеми

#### Грешке временског ограничења (timeout)

**Симптоми**:
- процес аутентикације истекне
- грешке "Request timeout" или слично
- спор ток аутентикације

**Рјешења**:
1. **Мрежна повезивост**:
   - Провјерите да правила firewall-а дозвољавају комуникацију са FastComments
   - Потврдите DNS резолуцију за fastcomments.com
   - Тестирајте мрежну повезивост из IdP-а према FastComments-у

2. **Проблеми са перформансама**:
   - Провјерите вријеме одзива IdP-а
   - Потврдите да валидација ланца сертификата није спор
   - Размотрите мрежну латенцију између IdP-а и корисника

#### SSL/TLS проблеми

**Симптоми**:
- упозорења о сертификату током аутентикације
- неуспјеси SSL handshake-а
- грешке "Secure connection failed"

**Рјешења**:
- Осигурајте да сви SAML крајњи пунктови користе HTTPS
- Провјерите важење сертификата за све укључене домене
- Потврдите компатибилност верзије TLS-а

### Дебаговање и логовање

#### Омогућавање информација за дебаговање

1. **Алати за развој у прегледачу**:
   - Пратите Network таб током SAML тока
   - Провјерите Console за JavaScript грешке
   - Испитујте SAML POST захтјеве (ако су видљиви)

2. **IdP логовање**:
   - Омогућите SAML дебаговање у вашем IdP-у
   - Прегледајте IdP логове за детаље захтјева/одговора SAML-а
   - Провјерите проблеме са мапирањем атрибута

#### Уобичајене поруке у логовима

**FastComments логови**:
- "SAML config not found" - SAML није омогућен или је погрешно конфигурисан
- "Invalid certificate" - валидација сертификата није успјела
- "Missing email attribute" - захтјевана е-пошта није прослијеђена у SAML одговору

**IdP логови**:
- "Unknown service provider" - неслагање Entity ID-а
- "Invalid ACS URL" - погрешан Assertion Consumer Service URL
- "User not assigned" - кориснику није додељен приступ SAML апликацији

### Добијање помоћи

#### Информације које треба прикупити

Када контактирате подршку, доставите:
- тачне поруке о грешкама и временске ознаке
- детаље SAML конфигурације (без осјетљивих података)
- тип и верзију IdP-а
- кораке за репродукцију проблема
- информације о прегледачу и мрежи

#### Подршка FastComments-а

За проблеме везане за SAML:
1. Користите [support portal](https://fastcomments.com/auth/my-account/help)
2. Укључите tenant ID и е-поште погођених корисника
3. Пружајте поруке о грешкама и детаље конфигурације
4. Наведите тип IdP-а и приступ конфигурацији

#### Подршка IdP-а

За специфичне проблеме са IdP-ом:
- Консултујте документацију IdP-а за SAML решавање проблема
- Користите канале подршке IdP-а за проблеме конфигурације
- Искористите IdP заједнице и форуме за уобичајене проблеме

### Савјети за превенцију

#### Најбоље праксе

1. **Тестирајте темељно**:
   - Тестирајте промјене конфигурације у не-продукционом окружењу
   - Потврдите са више тест корисника
   - Документујте радне конфигурације

2. **Редовно надгледање**:
   - Подесите мониторинг за неуспјеле SAML аутентикације
   - Прегледајте датуме истека сертификата
   - Надгледајте промјене у IdP конфигурацији

3. **Документација**:
   - Одржавајте документацију SAML конфигурације
   - Документујте било какве прилагођене конфигурације или привремена рјешења
   - Чувајте контакт информације за администраторе IdP-а

#### Проактивно одржавање

1. **Управљање сертификатима**:
   - Пратите датуме истека сертификата
   - Планирајте процедуре ротације сертификата
   - Тестирајте ажурирања сертификата прије истека

2. **Прегледи конфигурације**:
   - Редовно прегледајте SAML конфигурацију
   - Потврдите да IdP конфигурација остаје актуелна
   - Ажурирајте документацију како се промјене уносе