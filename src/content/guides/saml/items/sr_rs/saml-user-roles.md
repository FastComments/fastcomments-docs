FastComments мапира SAML улоге корисника на унутрашња дозволе, омогућавајући контролу приступа засновану на улогама за вашу организацију.

### Систем улога FastComments

FastComments користи систем дозвола заснован на улогама где корисници могу имати једну или више улога које одређују њихов ниво приступа и могућности.

### Доступне FastComments улоге

#### Административне улоге

**fc-account-owner**
- **Дозволе**: Потпун администраторски приступ
- **Могућности**: Све функције, управљање наплатом, управљање корисницима
- **Употреба**: Примарни администратори налога и власници

**fc-admin-admin**  
- **Дозволе**: Администраторски приступ већини функција
- **Могућности**: Управљање корисницима, конфигурација, модерација. **Може управљати другим администраторима.**
- **Употреба**: Секундарни администратори и ИТ особље

**fc-billing-admin**
- **Дозволе**: Управљање наплатом и претплатама
- **Могућности**: Начини плаћања, фактуре, измене претплата
- **Употреба**: Чланови финансијског тима и контакти за наплату

#### Специјализоване улоге

**fc-analytics-admin**
- **Дозволе**: Приступ аналитикама и извештавању
- **Могућности**: Преглед статистике сајта, података о ангажовању корисника
- **Употреба**: Маркетиншки тимови и аналитичари података

**fc-api-admin**
- **Дозволе**: Приступ API-ју и управљање
- **Могућности**: API акредитиви, конфигурација webhook-а
- **Употреба**: Девелопери и технички интегратори

**fc-moderator**
- **Дозволе**: Могућности модерације коментара
- **Могућности**: Одобравање/одбијање коментара, управљање спамом
- **Употреба**: Модератори заједнице и управљачи садржаја

### Конфигурација мапирања улога

#### Извори SAML атрибута

FastComments прихвата информације о улогама из различитих имена SAML атрибута како би обезбедио компатибилност са различитим провајдерима идентитета:

**Стандардна имена атрибута**:
- `roles`
- `groups` 
- `memberOf`
- `role`
- `group`

**Microsoft/ADFS атрибути**:
- `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
- `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role`

#### Подржани формати улога

**Формат низа** *(Препоручено)*:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin</saml:AttributeValue>
    <saml:AttributeValue>fc-moderator</saml:AttributeValue>
</saml:Attribute>
```

**Формат одвојен зарезом**:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin,fc-moderator</saml:AttributeValue>
</saml:Attribute>
```

**Формат једне улоге**:
```xml
<saml:Attribute Name="roles">
    <saml:AttributeValue>fc-admin-admin</saml:AttributeValue>
</saml:Attribute>
```

### Конфигурација улога провајдера идентитета

#### Microsoft Azure AD

1. **App Roles Configuration**:
   - Дефинишите FastComments улоге у вашој Azure AD апликацији
   - Доделите кориснике одговарајућим апликационим улогама
   - Конфигуришите claims да укључују додељене улоге

2. **Attribute Mapping**:
   ```
   Attribute Name: roles
   Source Attribute: user.assignedroles
   ```

#### Okta

1. **Group Assignment**:
   - Креирајте групе које одговарају именима FastComments улога
   - Доделите кориснике одговарајућим групама
   - Конфигуришите attribute statements

2. **Attribute Statement**:
   ```
   Name: roles
   Value: user.groups
   Filter: Starts with "fc-"
   ```

#### Google Workspace

1. **Group Mapping**:
   - Креирајте организационе јединице или групе
   - Именујте групе са префиксима FastComments улога
   - Конфигуришите мапирање атрибута

2. **Custom Attributes**:
   ```
   Attribute Name: roles
   Value: Groups or custom schema attribute
   ```

### Подразумевано понашање корисника

#### Корисници без улога

Када SAML корисник нема улоге или има непознате улоге:
- Корисник се креира као стандардни коментатор
- Не добија администраторски приступ
- Може објављивати и управљати својим коментарима
- Не може приступити функцијама контролне табле администратора

#### Наслеђивање улога

- Корисници могу истовремено имати више улога
- Дозволе су кумулативне (примењује се највиши ниво дозвола)
- Промене улога у IdP-у се одражавају при следећем пријављивању

### Управљање SAML корисницима

#### Креирање корисника

Када се корисник први пут пријави преко SAML-а:
1. **User Account**: Аутоматски креиран са е-поштом као идентификатором
2. **Role Assignment**: Улоге се примењују на основу SAML атрибута
3. **Profile Information**: Име/презиме попуњени ако су обезбеђени
4. **Permission Activation**: Улоге постају активне одмах

#### Ажурирања улога

Постојећи SAML корисници добијају ажурирања улога:
1. **Login Trigger**: Ажурирања улога се врше током сваке SAML пријаве
2. **Immediate Effect**: Нове дозволе се примењују одмах
3. **Role Removal**: Уклоњене улоге се аутоматски укидају
4. **Audit Trail**: Промене улога се евидентирају у логовима ревизије

### Прилагођено мапирање улога

#### Прилагођавање за ентерпрајз

За ентерпрајз кориснике са специфичним захтевима:
- Прилагођена имена улога могу се мапирати на FastComments дозволе
- Могу се имплементирати сложене хијерархије улога
- Могу се конфигурисати контроле приступа специфичне за одељења

Контактирајте FastComments подршку за конфигурације прилагођеног мапирања улога.

#### Валидација улога

FastComments валидаје долазне улоге:
- Непознате улоге се игноришу (не одбијају се)
- Неисправно форматирани атрибути улога се евидентирају за решавање проблема
- Корисници задржавају постојеће улоге ако SAML изјава нема информације о улогама

### Најбоље праксе

#### Управљање улогама

1. **Принцип најмањих привилегија**: Доделите минимално неопходне дозволе
2. **Редовна ревизија**: Повремено прегледајте улоге корисника и приступ  
3. **Јасно именовање**: Користите описна имена група у свом IdP-у
4. **Документација**: Одржавајте документацију додела улога

#### Безбедносна разматрања

1. **Атрибути улога**: Обезбедите да су атрибути улога правилно заштићени у SAML одговорима
2. **Валидација атрибута**: Потврдите да само овлашћени системи могу додељивати улоге
3. **Прегледи приступа**: Редовно прегледајте доделе административних улога
4. **Мониторинг**: Пратите промене улога и административне акције

### Решавање проблема са улогама

#### Чести проблеми

**Улоге се не примењу**
- Проверите да имена SAML атрибута одговарају подржаним форматима
- Потврдите да IdP шаље информације о улогама
- Потврдите да вредности улога тачно одговарају именима FastComments улога

**Приступ одбијен**:
- Проверите да ли је кориснику у IdP-у додељена одговарајућа улога
- Проверите правопис улоге и осетљивост на велика/мала слова
- Потврдите да је улога правилно форматирана у SAML одговору

**Недостајуће дозволе**:
- Прегледајте дефиниције улога и потребне дозволе
- Проверите да ли постоје конфликтне доделе улога
- Потврдите да се корисник пријавио након промена улога

---