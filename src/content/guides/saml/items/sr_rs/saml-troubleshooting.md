Ово упутство покрива уобичајене проблеме са SAML аутентификацијом и њихова решења.

### Проблеми са сертификатима и безбедношћу

#### Грешка неважећег сертификата

**Симптоми**:
- "Certificate validation failed" грешка
- Корисници не могу да заврше SAML аутентификацију
- SAML одговори се одбацују

**Уобичајени узроци**:
- Формат сертификата је нетачан
- Сертификат је истекао
- Поступљен је погрешан сертификат
- Додатни карактери или размак у сертификату

**Решења**:
1. **Проверите формат сертификата**:
   - Уверите се да сертификат садржи `-----BEGIN CERTIFICATE-----` и `-----END CERTIFICATE-----` маркере
   - Уклоните све додатне размаке или прекиде линија
   - Копирајте сертификат директно из IdP метаподатака или конфигурације

2. **Проверите важење сертификата**:
   - Проверите да сертификат није истекао
   - Потврдите да је сертификат намењен исправном IdP-у
   - Користите онлајн валидаторе сертификата да проверите формат

3. **Преузмите сертификат поново**:
   - Преузмите свеж сертификат са IdP-а
   - Користите IdP метаподатке URL ако је доступан
   - Потврдите да сертификат одговара текућој конфигурацији IdP-а

#### Потврда дигиталног потписа није успела

**Симптоми**:
- Грешке при валидацији подписа SAML изјаве
- Аутентификација не успева након пријаве на IdP
- Поруке о грешци "Invalid signature"

**Решења**:
1. **Неусклађеност алгоритма**:
   - Проверите да алгоритам подписа у FastComments одговара оном у IdP-у
   - Испробајте различите алгоритме подписа (SHA-256, SHA-1, SHA-512)
   - Верификујте да се алгоритам дигеста поклапа са конфигурацијом IdP-а

2. **Проблеми са сертификатом**:
   - Уверите се да је подешен исправан сертификат за потписивање
   - Проверите да ли сертификат одговара приватном кључу који користи IdP
   - Проверите да ли је дошло до ротирања сертификата у IdP-у

### Проблеми са конфигурацијом

#### Погрешан Entity ID или ACS URL

**Симптоми**:
- IdP пријављује "Unknown Service Provider"
- SAML одговори иду на погрешан крајњи пункт
- Аутентификација се не завршава

**Решења**:
1. **Проверите податке о SP-у**:
   - Копирајте тачан Entity ID из FastComments конфигурације
   - Уверите се да ACS URL одговара формату: `https://fastcomments.com/saml/callback/{tenant-id}`
   - Проверите правописне грешке у tenant ID

2. **Конфигурација у IdP-у**:
   - Ажурирајте IdP са исправним SP Entity ID-ом
   - Конфигуришите исправан ACS/Reply URL
   - Верификујте подешавања биндинга у IdP-у (HTTP-POST је препоручен)

#### Недостајући или нетачни атрибути

**Симптоми**:
- Корисници се креирају без одговарајућих улога
- Недостају подаци профила корисника
- Поруке о грешци "Email required"

**Решења**:
1. **Атрибут е-поште**:
   - Уверите се да IdP шаље атрибут е-поште
   - Проверите мапирање имена атрибута (email, emailAddress, итд.)
   - Верификујте да је вредност е-поште важећа адреса е-поште

2. **Атрибути улоге**:
   - Потврдите да IdP шаље информације о улогама/групама
   - Проверите да имена атрибута улоге одговарају очекивањима FastComments-а
   - Верификујте да се вредности улога тачно поклапају са именима улога у FastComments-у

3. **Формат атрибута**:
   - Тестирајте и низове и формат улога раздвојених зарезом
   - Уверите се да вредности атрибута немају додатне размаке
   - Проверите осетљивост на велика/мала слова у именима улога

### Проблеми у току аутентификације

#### Циклус преусмеравања

**Симптоми**:
- Прегледач се бескрајно преусмерава између FastComments-а и IdP-а
- Аутентификација никада не завршава
- Више преусмеравања видљиво у алатима за развој прегледача

**Решења**:
1. **Проверите SP конфигурацију**:
   - Верификујте да се Entity ID потпуно поклапа са конфигурацијом у IdP-у
   - Уверите се да је ACS URL исправно конфигурисан у IdP-у
   - Проверите постојање косих црта на крају URL-ова

2. **Проблеми са сесијом**:
   - Обришите колачиће прегледача и покушајте поново
   - Тестирајте у инкогнито/приватном прозору прегледача
   - Проверите подешавања времена трајања сесије

#### Приступ одбијен након аутентификације

**Симптоми**:
- SAML аутентификација успева
- Корисник је преусмерен на FastComments
- Приказује се порука "Access denied" или грешка у дозволама

**Решења**:
1. **Додела улога**:
   - Верификујте да корисник има одговарајуће улоге у IdP-у
   - Проверите да ли се атрибут улоге шаље у SAML одговору
   - Потврдите да се имена улога тачно поклапају са захтевима FastComments-а

2. **Ограничења пакета**:
   - Проверите да налог има Flex или Pro план
   - Проверите да ли је SAML функција омогућена за пакет
   - Контактирајте подршку ако пакет укључује SAML али функција није доступна

### Проблеми специфични за провајдера идентитета

#### Microsoft Azure AD

**Уобичајени проблеми**:
- Доделе улога апликације се не појављују у токенима
- Клајмови се не шаљу исправно
- Захтеви за доделу корисника

**Решења**:
- Проверите да ли је корисник додељен FastComments апликацији
- Верификујте да су улоге апликације правилно конфигурисане
- Уверите се да мапирање клајмова садржи потребне атрибуте

#### Okta

**Уобичајени проблеми**:
- Филтери група не раде правилно
- Изјаве о атрибутима су неправилно конфигурисане
- Проблеми са доделом апликације

**Решења**:
- Прегледајте конфигурацију изјава о атрибутима
- Проверите доделу групе и правила филтрирања
- Верификујте да је апликација додељена одговарајућим корисницима/групама

#### Google Workspace

**Уобичајени проблеми**:
- Прилагођени атрибути се не мапирају исправно
- Чланство у групи се не шаље
- Грешке у конфигурацији SAML апликације

**Решења**:
- Конфигуришите прилагођени шема за атрибуте улоге
- Проверите пропагацију чланства у групи
- Верификујте мапирање атрибута у SAML апликацији

### Проблеми са мрежом и повезивањем

#### Грешке временског ограничења

**Симптоми**:
- Процес аутентификације истекне
- "Request timeout" или сличне грешке
- Споро трајање аутентификације

**Решења**:
1. **Мрежна повезивост**:
   - Проверите да firewall правила дозвољавају комуникацију са FastComments
   - Верификујте DNS резолуцију за fastcomments.com
   - Тестирајте мрежну повезивост од IdP-а до FastComments-а

2. **Проблеми перформанси**:
   - Проверите време одговора IdP-а
   - Верификујте да валидација ланца сертификата није спора
   - Размотрите латенцију мреже између IdP-а и корисника

#### SSL/TLS проблеми

**Симптоми**:
- Упозорења о сертификату током аутентификације
- Неуспеси SSL руковања
- Поруке о грешци "Secure connection failed"

**Решења**:
- Уверите се да сви SAML крајњи пунктови користе HTTPS
- Проверите важење сертификата за све укључене домене
- Верификујте компатибилност верзија TLS-а

### Отстрањавање грешака и логовање

#### Омогућавање дебаг информација

1. **Алати за развој у прегледачу**:
   - Пратите табелу Network током SAML тока
   - Проверите Console за JavaScript грешке
   - Испитајте SAML POST захтеве (ако су видљиви)

2. **Логовање у IdP-у**:
   - Омогућите SAML дебаговање у вашем IdP-у
   - Прегледајте IdP логове за детаље захтева/одговора SAML-а
   - Проверите проблеме у мапирању атрибута

#### Уобичајене поруке у логовима

**FastComments Logs**:
- "SAML config not found" - SAML not enabled or misconfigured
- "Invalid certificate" - Certificate validation failed
- "Missing email attribute" - Required email not provided in SAML response

**IdP Logs**:
- "Unknown service provider" - Entity ID mismatch
- "Invalid ACS URL" - Assertion Consumer Service URL incorrect
- "User not assigned" - User lacks access to SAML application

### Добијање помоћи

#### Информације које треба прикупити

Када контактирате подршку, наведите:
- Тачне поруке о грешкама и временске ознаке
- Детаље о SAML конфигурацији (без осетљивих података)
- Тип и верзију IdP-а
- Степене за репродукцију проблема
- Информације о прегледачу и мрежи

#### Подршка FastComments

За проблеме везане за SAML:
1. Користите [портал за подршку](https://fastcomments.com/auth/my-account/help)
2. Укључите tenant ID и адресе е-поште погођених корисника
3. Обезбедите поруке о грешкама и детаље конфигурације
4. Назначите тип IdP-а и приступ конфигурацији

#### Подршка IdP-а

За проблеме специфичне за IdP:
- Консултујте документацију IdP-а за решавање SAML проблема
- Користите канале за подршку IdP-а за проблеме конфигурације
- Искористите заједничке форуме IdP-а за уобичајене проблеме

### Савети за превенцију

#### Најбоље праксе

1. **Тестирајте темељно**:
   - Тестирајте измене конфигурације у непроизводном окружењу
   - Верификујте са више тест корисника
   - Документујте радне конфигурације

2. **Редовно праћење**:
   - Подесите праћење за неуспехе SAML аутентификације
   - Прегледајте датуме истека сертификата
   - Пратите промене у конфигурацији IdP-а

3. **Документација**:
   - Одржавајте документацију SAML конфигурације
   - Документујте све прилагођене конфигурације или привремена решења
   - Чувајте контакт информације администратора IdP-а

#### Проактивно одржавање

1. **Управљање сертификатима**:
   - Пратите датуме истека сертификата
   - Планирајте процедуре ротирања сертификата
   - Тестирајте ажурирања сертификата пре истека

2. **Прегледи конфигурације**:
   - Редовно прегледајте SAML конфигурацију
   - Потврдите да конфигурација IdP-а остаје актуелна
   - Ажурирајте документацију када се праве измене