### How Text Selection Works

Коли користувачі виділяють текст у контейнері Collab Chat, віджет фіксує це виділення і дозволяє їм розпочати обговорення. Виділення може бути настільки малим, як одне слово, або настільки великим, як кілька абзаців, що охоплюють різні елементи.

### Selection Delay

На настільних пристроях існує затримка в 3.5 секунди між моментом, коли користувач виділяє текст, і появою підказки для обговорення. Це запобігає мерехтінню інтерфейсу, коли користувачі просто виділяють текст, щоб скопіювати або прочитати його. На мобільних пристроях підказка з’являється негайно, оскільки вибір тексту на сенсорних екранах зазвичай відбувається більш усвідомлено.

### Unique Conversation IDs

Кожна розмова отримує унікальний `urlId`, який поєднує URL сторінки, шлях елемента DOM і серіалізований діапазон тексту. Це гарантує, що кожне виділення тексту створює окрему розмову, яку можна знайти пізніше.

Якщо ви вкажете власний `urlId` у конфігурації, він буде поєднаний із шляхом елемента та діапазоном тексту для створення остаточного ідентифікатора.

### Visual Highlights

Коли для певного виділення тексту існує обговорення, цей текст отримує візуальне підсвічування. Підсвітка реалізована за допомогою фонових кольорів і з’являється при наведені або коли пов’язане вікно чату відкрите.

Система підсвітки працює шляхом обгортання виділеного тексту в спеціальний елемент, який можна стилізувати. Такий підхід забезпечує, що підсвітки залишаються точними навіть тоді, коли базова структура HTML складна.

### Chat Window Positioning

Коли користувач клацає на підсвітці або створює нову анотацію, біля виділеного тексту з’являється вікно чату. Віджет автоматично обчислює найкраще положення для цього вікна з урахуванням доступного простору в області перегляду.

Система позиціонування використовує CSS-класи, такі як `to-right`, `to-left`, `to-top` і `to-bottom`, щоб вказати напрямок, у якому має розгортатися вікно чату від підсвітки. На мобільних пристроях (екрани шириною менше 768px) вікно чату завжди з’являється у повноекранному режимі для кращої зручності.

### Chat Window Dimensions

Вікна чату мають ширину 410px на настільних пристроях із відступом 20px і візуальною стрілкою 16px, що вказує на підсвічений текст. Ці розміри фіксовані для забезпечення послідовної поведінки, але ви можете налаштувати зовнішній вигляд за допомогою CSS.

### Cross-Element Selections

Користувачі можуть виділяти текст, який охоплює кілька HTML-елементів, наприклад виділення від середини одного абзацу до початку іншого. Система серіалізації діапазонів обробляє це правильно і підсвітить увесь виділений текст навіть через межі елементів.

### Browser Compatibility

Система виділення тексту використовує стандартний API `window.getSelection()`, який підтримується у всіх сучасних браузерах. Для старіших версій Internet Explorer використовується резервний варіант `document.selection` для сумісності.

### Selection Persistence

Після створення розмови для виділеного тексту ця анотація зберігається навіть якщо сторінка перезавантажиться. Серіалізований діапазон і шлях DOM дозволяють віджету відновити підсвітки в точно тому самому місці, коли користувачі повертаються на сторінку.

Це працює надійно, доки вміст вашої сторінки залишається стабільним. Якщо ви зміните текстовий вміст або перебудуєте HTML, існуючі анотації можуть більше не відповідати тексту. З цієї причини краще уникати суттєвих змін вмісту на сторінках з активними анотаціями або розглянути можливість міграції анотацій, коли зміни вмісту неминучі.