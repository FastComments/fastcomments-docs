### Ενημερώσεις σε Πραγματικό Χρόνο

Το Collab Chat χρησιμοποιεί συνδέσεις WebSocket για να συγχρονίζει όλες τις συνομιλίες σε πραγματικό χρόνο σε όλους τους συνδεδεμένους χρήστες. Όταν κάποιος δημιουργεί μια νέα σημείωση, προσθέτει ένα σχόλιο ή διαγράφει μια συζήτηση, όλοι οι άλλοι χρήστες που βλέπουν την ίδια σελίδα βλέπουν την ενημέρωση αμέσως χωρίς να χρειάζεται ανανέωση.

### Πώς λειτουργεί ο συγχρονισμός WebSocket

Όταν αρχικοποιείτε το Collab Chat, το widget ανοίγει μια σύνδεση WebSocket προς τους διακομιστές της FastComments. Αυτή η σύνδεση παραμένει ανοιχτή για τη διάρκεια της συνεδρίας του χρήστη και ακούει για ενημερώσεις σχετικές με την τρέχουσα σελίδα.

Το σύστημα WebSocket χρησιμοποιεί τρεις τύπους broadcast μηνυμάτων για το Collab Chat. Το event `new-text-chat` ενεργοποιείται όταν κάποιος δημιουργεί μια νέα σημείωση στη σελίδα. Το event `updated-text-chat` ενεργοποιείται όταν κάποιος ενημερώνει μια υπάρχουσα συζήτηση. Το event `deleted-text-chat` ενεργοποιείται όταν κάποιος διαγράφει μια σημείωση.

### Σύστημα Broadcast ID

Για να αποτραπεί το φαινόμενο ηχώ όπου οι χρήστες βλέπουν τις δικές τους ενέργειες να εκπέμπονται ξανά σε αυτούς, κάθε ενημέρωση περιλαμβάνει ένα μοναδικό `broadcastId`. Όταν ένας χρήστης δημιουργεί ή ενημερώνει μια σημείωση, ο client του δημιουργεί ένα UUID για αυτήν την ενέργεια. Όταν το WebSocket εκπέμπει την ενημέρωση πίσω σε όλους τους clients, ο αρχικός client αγνοεί την ενημέρωση επειδή ταιριάζει με το δικό του `broadcastId`.

Αυτό εξασφαλίζει ομαλή αλληλεπίδραση όπου οι χρήστες βλέπουν τις αλλαγές τους αμέσως στο UI χωρίς να περιμένουν την εμπρόσθια-οπισθιά μετάδοση μέσω του διακομιστή, ενώ ταυτόχρονα διασφαλίζεται ότι όλοι οι άλλοι χρήστες λαμβάνουν την ενημέρωση.

### Ζωντανή καταμέτρηση χρηστών

Η επάνω γραμμή εμφανίζει τον αριθμό των χρηστών που αυτή τη στιγμή βλέπουν τη σελίδα. Αυτή η καταμέτρηση ενημερώνεται σε πραγματικό χρόνο καθώς οι χρήστες συνδέονται και αποσυνδέονται. Ο αριθμός χρηστών παρέχεται μέσω της ίδιας σύνδεσης WebSocket και αυξομειώνεται αυτόματα βάσει των γεγονότων σύνδεσης και αποσύνδεσης.

### Ανθεκτικότητα σύνδεσης

Εάν η σύνδεση WebSocket διακοπεί λόγω προβλημάτων δικτύου ή συντήρησης του διακομιστή, το widget προσπαθεί αυτόματα να επανασυνδεθεί. Κατά τη διάρκεια της περιόδου επανασύνδεσης, οι χρήστες μπορούν να συνεχίσουν να αλληλεπιδρούν με τις υπάρχουσες σημειώσεις, αλλά δεν θα βλέπουν ενημερώσεις σε πραγματικό χρόνο από άλλους χρήστες μέχρι να αποκατασταθεί η σύνδεση.

Μόλις επανασυνδεθεί, το widget επανασυγχρονίζει για να διασφαλίσει ότι δεν χάθηκαν ενημερώσεις. Αυτό συμβαίνει διαφανώς χωρίς να απαιτείται παρέμβαση του χρήστη.

### Θέματα εύρους ζώνης

Τα μηνύματα WebSocket είναι ελαφριά και περιέχουν μόνο τις απαραίτητες πληροφορίες που χρειάζονται για τον συγχρονισμό της κατάστασης. Η δημιουργία μιας νέας σημείωσης συνήθως καταναλώνει λιγότερο από 1KB εύρους ζώνης. Το σύστημα περιλαμβάνει επίσης έξυπνη ομαδοποίηση για τη μείωση της συχνότητας των μηνυμάτων κατά τις περιόδους υψηλής δραστηριότητας.

Τα στατιστικά χρήσης σας στον πίνακα ελέγχου FastComments παρακολουθούν τα `pubSubMessageCount` και `pubSubBandwidth` ώστε να μπορείτε να επιβλέπετε τη δραστηριότητα συγχρονισμού σε πραγματικό χρόνο στις τοποθεσίες σας.

### Συγχρονισμός μεταξύ καρτελών

Εάν ένας χρήστης έχει την ίδια σελίδα ανοιχτή σε πολλαπλές καρτέλες του προγράμματος περιήγησης, οι ενημερώσεις σε μια καρτέλα εμφανίζονται αμέσως στις άλλες καρτέλες. Αυτό λειτουργεί μέσω του ίδιου μηχανισμού συγχρονισμού WebSocket και δεν απαιτεί καμία επιπλέον ρύθμιση.

### Ασφάλεια

Τα μηνύματα WebSocket μεταδίδονται μέσω ασφαλών συνδέσεων (WSS) και περιλαμβάνουν tenant validation για να διασφαλιστεί ότι οι χρήστες λαμβάνουν μόνο ενημερώσεις για συνομιλίες που έχουν εξουσιοδότηση να βλέπουν. Ο διακομιστής επικυρώνει όλες τις λειτουργίες πριν τις εκπέμψει για να αποτρέψει μη εξουσιοδοτημένη πρόσβαση ή παραποίηση.