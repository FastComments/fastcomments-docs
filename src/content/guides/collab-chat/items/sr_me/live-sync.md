### Ажурирања у реалном времену

Collab Chat користи WebSocket везе да синхронизује све разговоре у реалном времену међу свим повезаним корисницима. Када неко креира нову анотацију, дода коментар или обрише дискусију, сви остали корисници који гледају исту страницу виде ажурирање одмах без освежавања.

### Како WebSocket синхронизација функционише

Када иницијализујете Collab Chat, видгет успоставља WebSocket везу са FastComments серверима. Ова веза остаје отворена током трајања корисничке сесије и прати ажурирања везана за текућу страницу.

WebSocket систем користи три типа broadcast порука за Collab Chat. Догађај `new-text-chat` се активира када неко креира нову анотацију на страници. Догађај `updated-text-chat` се активира када неко ажурира постојећи разговор. Догађај `deleted-text-chat` се активира када неко обрише анотацију.

### Систем Broadcast ID-а

Да би се спречили ефекти еха у којима корисници виде своје акције како им се емитују назад, свако ажурирање укључује јединствени `broadcastId`. Кад корисник креира или ажурира анотацију, његов клијент генерише UUID за ту операцију. Када WebSocket емитује ажурирање назад свим клијентима, клијент који је иницирао операцију игнорише то ажурирање јер се поклапа са његовим сопственим `broadcastId`.

Ово обезбеђује глатку интеракцију у којој корисници виде своје промене одмах у UI-у без чекања на круг-пут преко сервера, а истовремено сви остали корисници добијају ажурирање.

### Број корисника уживо

Горња трака приказује број корисника који тренутно гледају страницу. Овај број се ажурира у реалном времену како корисници долазе и одлазе. Број корисника се обезбеђује преко исте WebSocket везе и аутоматски се увећава/смањује на основу догађаја повезивања и прекида везе.

### Отпорност везе

Ако WebSocket веза падне због проблема са мрежом или одржавања сервера, видгет аутоматски покушава поновно да се повеже. Током периода поновног повезивања, корисници и даље могу да интерагују са постојећим анотацијама, али неће видети ажурирања у реалном времену од других корисника све док веза не буде поново успостављена.

Кад се веза поново успостави, видгет се поново синхронизује како би се осигурало да ниједно ажурирање није пропуштено. Ово се дешава аутоматски, без потребе за интервенцијом корисника.

### Разматрања пропусног опсега

WebSocket поруке су лагане и садрже само основне информације потребне за синхронизацију стања. Креирање нове анотације обично користи мање од 1KB пропусног опсега. Систем такође укључује интелигентно груписање порука како би смањио учесталост порука током периода високе активности.

Ваши метрики употребе у FastComments контролној табли прате `pubSubMessageCount` и `pubSubBandwidth` како бисте могли да пратите активност синхронизације у реалном времену на својим сајтовима.

### Синхронизација између картица

Ако корисник има исту страницу отворену у више картица прегледача, ажурирања у једној картици се појављују одмах у осталим картицама. Ово ради кроз исти механизам WebSocket синхронизације и не захтева додатну конфигурацију.

### Безбедност

WebSocket поруке се преносе преко сигурних веза (WSS) и укључују валидацију tenant-а како би се осигурало да корисници примају само ажурирања за разговоре које су овлашћени да виде. Сервер валидаје све операције пре емитовања како би спречио неовлашћен приступ или манипулацију.