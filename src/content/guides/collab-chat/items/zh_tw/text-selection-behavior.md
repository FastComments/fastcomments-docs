### How Text Selection Works

當使用者在 Collab Chat 容器中選取文字時，元件會擷取該選取範圍並允許他們開始討論。選取範圍可以小到單字，也可以大到跨越不同元素的多個段落。

### Selection Delay

在桌面裝置上，使用者選取文字與討論提示出現之間會有 3.5 秒的延遲。這可避免使用者僅為了複製或閱讀而暫時標記文字時造成介面閃爍。在行動裝置上，因為在觸控螢幕上選取文字通常較為刻意，提示會立即出現。


### Unique Conversation IDs

每個會話都會有一個唯一的 `urlId`，它結合了頁面 URL、DOM 元素路徑以及序列化的文字範圍。這可確保每次文字選取都會建立一個可供日後再次找到的不同會話。

如果您在設定中提供自訂的 `urlId`，它會與元素路徑和文字範圍結合以建立最終識別碼。

### Visual Highlights

當特定文字選取有討論存在時，該文字會獲得視覺高亮。高亮是使用背景顏色實作的，並在滑鼠停留或相關聊天室開啟時顯示。

高亮系統的實作方式是將被選取的文字包裹在可套用樣式的特殊元素中。此方法可確保即使在底層 HTML 結構複雜時，高亮仍能保持準確。

### Chat Window Positioning

當使用者點擊高亮或建立新的註解時，聊天視窗會出現在靠近選取文字的位置。元件會根據可用的視窗空間自動計算該視窗的最佳位置。

定位系統會使用像是 `to-right`、`to-left`、`to-top` 與 `to-bottom` 的 CSS 類別來指示聊天視窗應該從高亮延伸的方向。在行動裝置（螢幕寬度低於 768px）上，聊天視窗為了更佳可用性會固定以全螢幕顯示。

### Chat Window Dimensions

聊天視窗在桌面上寬度為 410px，並具有 20px 的間距，以及一個指向高亮文字的 16px 視覺箭頭。這些尺寸是固定的以確保行為一致，但您可以使用 CSS 自訂外觀。

### Cross-Element Selections

使用者可以選取跨越多個 HTML 元素的文字，例如從某段落的中間標記到另一段落的開始。範圍序列化系統能夠正確處理此情況，並在元素邊界跨越時仍將所有被選取的文字標示出來。

### Browser Compatibility

文字選取系統使用標準的 `window.getSelection()` API，該 API 在所有現代瀏覽器中都受支援。對於較舊版本的 Internet Explorer，則會回退使用 `document.selection` 以維持相容性。

### Selection Persistence

一旦為文字選取建立了會話，該註解即使在重新載入頁面後也會持續存在。序列化的範圍與 DOM 路徑允許元件在使用者回到頁面時在完全相同的位置還原高亮。

只要您的頁面內容保持穩定，此機制就能可靠運作。如果您變更文字內容或重構 HTML，既有的註解可能就無法再與文字正確對齊。因此，建議在具有活動註解的頁面上避免進行重大內容變更，或在必要變更內容時考慮遷移註解。