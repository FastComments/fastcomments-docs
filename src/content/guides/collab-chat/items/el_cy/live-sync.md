### Ενημερώσεις σε Πραγματικό Χρόνο

Το Collab Chat χρησιμοποιεί συνδέσεις WebSocket για να συγχρονίζει όλες τις συνομιλίες σε πραγματικό χρόνο σε όλους τους συνδεδεμένους χρήστες. Όταν κάποιος δημιουργεί μια νέα επισήμανση, προσθέτει ένα σχόλιο ή διαγράφει μια συζήτηση, όλοι οι άλλοι χρήστες που βλέπουν την ίδια σελίδα βλέπουν την ενημέρωση αμέσως χωρίς ανανέωση.

### Πώς λειτουργεί ο Συγχρονισμός με WebSocket

Όταν αρχικοποιείτε το Collab Chat, το widget δημιουργεί μια σύνδεση WebSocket με τους διακομιστές του FastComments. Αυτή η σύνδεση παραμένει ανοιχτή για τη διάρκεια της συνεδρίας του χρήστη και ακούει για ενημερώσεις σχετικές με την τρέχουσα σελίδα.

Το σύστημα WebSocket χρησιμοποιεί τρεις τύπους μηνυμάτων εκπομπής για το Collab Chat. Το γεγονός `new-text-chat` πυροδοτείται όταν κάποιος δημιουργεί μια νέα επισήμανση στη σελίδα. Το γεγονός `updated-text-chat` πυροδοτείται όταν κάποιος ενημερώνει μια υπάρχουσα συνομιλία. Το γεγονός `deleted-text-chat` πυροδοτείται όταν κάποιος διαγράφει μια επισήμανση.

### Σύστημα Broadcast ID

Για να αποτραπούν φαινόμενα ηχώ όπου οι χρήστες βλέπουν τις δικές τους ενέργειες να εκπέμπονται πίσω σε αυτούς, κάθε ενημέρωση περιλαμβάνει ένα μοναδικό `broadcastId`. Όταν ένας χρήστης δημιουργεί ή ενημερώνει μια επισήμανση, ο client του δημιουργεί ένα UUID για αυτή την ενέργεια. Όταν το WebSocket εκπέμπει ξανά την ενημέρωση σε όλους τους clients, ο αρχικός client αγνοεί την ενημέρωση επειδή ταιριάζει με το δικό του `broadcastId`.

Αυτό εξασφαλίζει ομαλή αλληλεπίδραση όπου οι χρήστες βλέπουν τις αλλαγές τους αμέσως στο UI χωρίς να περιμένουν την επιστροφή μέσω του διακομιστή, ενώ ταυτόχρονα όλοι οι άλλοι χρήστες λαμβάνουν την ενημέρωση.

### Ζωντανός Αριθμός Χρηστών

Η πάνω μπάρα εμφανίζει τον αριθμό των χρηστών που αυτή τη στιγμή βλέπουν τη σελίδα. Αυτός ο αριθμός ενημερώνεται σε πραγματικό χρόνο καθώς οι χρήστες μπαίνουν και φεύγουν. Ο αριθμός χρηστών παρέχεται μέσω της ίδιας σύνδεσης WebSocket και αυξομειώνεται αυτόματα με βάση τα γεγονότα σύνδεσης και αποσύνδεσης.

### Ανθεκτικότητα Σύνδεσης

Εάν η σύνδεση WebSocket διακοπεί λόγω προβλημάτων δικτύου ή συντήρησης διακομιστή, το widget προσπαθεί αυτόματα να επανασυνδεθεί. Κατά την περίοδο επανασύνδεσης, οι χρήστες μπορούν ακόμη να αλληλεπιδρούν με υπάρχουσες επισημάνσεις, αλλά δεν θα βλέπουν ενημερώσεις σε πραγματικό χρόνο από άλλους χρήστες μέχρι να αποκατασταθεί η σύνδεση.

Μόλις επανασυνδεθεί, το widget επανασυγχρονίζεται για να διασφαλίσει ότι δεν χάθηκαν ενημερώσεις. Αυτό γίνεται διαφανώς χωρίς να απαιτείται παρέμβαση του χρήστη.

### Προβληματισμοί για το Εύρος Ζώνης

Τα μηνύματα WebSocket είναι ελαφριά και περιέχουν μόνο τις απαραίτητες πληροφορίες που χρειάζονται για τον συγχρονισμό της κατάστασης. Η δημιουργία μιας νέας επισήμανσης συνήθως χρησιμοποιεί λιγότερο από 1KB εύρους ζώνης. Το σύστημα περιλαμβάνει επίσης έξυπνη ομαδοποίηση για να μειώσει τη συχνότητα των μηνυμάτων κατά τις περιόδους υψηλής δραστηριότητας.

Τα στατιστικά χρήσης σας στον πίνακα ελέγχου του FastComments παρακολουθούν τα `pubSubMessageCount` και `pubSubBandwidth` ώστε να μπορείτε να παρακολουθείτε τη δραστηριότητα συγχρονισμού σε πραγματικό χρόνο σε όλο το site σας.

### Συγχρονισμός μεταξύ καρτελών

Εάν ένας χρήστης έχει την ίδια σελίδα ανοιχτή σε πολλαπλές καρτέλες του προγράμματος περιήγησης, οι ενημερώσεις σε μια καρτέλα εμφανίζονται αμέσως στις άλλες καρτέλες. Αυτό λειτουργεί μέσω του ίδιου μηχανισμού συγχρονισμού WebSocket και δεν απαιτεί επιπλέον ρύθμιση.

### Ασφάλεια

Τα μηνύματα WebSocket μεταδίδονται μέσω ασφαλών συνδέσεων (WSS) και περιλαμβάνουν επικύρωση tenant ώστε να διασφαλίζεται ότι οι χρήστες λαμβάνουν μόνο ενημερώσεις για συνομιλίες που έχουν εξουσιοδότηση να δουν. Ο διακομιστής επικυρώνει όλες τις ενέργειες πριν τις εκπέμψει για να αποτραπεί μη εξουσιοδοτημένη πρόσβαση ή παραποίηση.