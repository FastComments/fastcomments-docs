### How Text Selection Works

Когда пользователи выделяют текст внутри контейнера Collab Chat, виджет фиксирует это выделение и позволяет им начать обсуждение. Выделение может быть таким маленьким, как одно слово, или таким большим, как несколько абзацев, охватывающих разные элементы.

### Selection Delay

На настольных устройствах существует задержка в 3.5 секунды между моментом, когда пользователь выделяет текст, и появлением подсказки для обсуждения. Это предотвращает мерцание интерфейса, когда пользователи просто выделяют текст для копирования или чтения. На мобильных устройствах подсказка появляется немедленно, поскольку выделение текста на сенсорных экранах обычно более обдуманное.

### Unique Conversation IDs

Каждый разговор получает уникальный `urlId`, который комбинирует URL страницы, путь к элементу DOM и сериализованный диапазон текста. Это гарантирует, что каждое выделение текста создаёт отдельный разговор, который можно вновь найти позже.

Если вы укажете собственный `urlId` в конфигурации, он будет объединён с путем элемента и диапазоном текста для создания итогового идентификатора.

### Visual Highlights

Когда для определённого выделения текста существует обсуждение, этот текст получает визуальное выделение. Выделение реализуется с помощью фоновых цветов и появляется при наведении или когда связанное окно чата открыто.

Система подсветки работает, оборачивая выбранный текст в специальный элемент, которому можно задать стили. Такой подход гарантирует, что подсветки остаются точными даже при сложной структуре HTML.

### Chat Window Positioning

Когда пользователь кликает по подсветке или создаёт новую аннотацию, рядом с выделенным текстом появляется окно чата. Виджет автоматически рассчитывает оптимальное положение этого окна на основе доступного пространства в области просмотра.

Система позиционирования использует CSS-классы, такие как `to-right`, `to-left`, `to-top` и `to-bottom`, чтобы указать, в каком направлении окно чата должно располагаться относительно подсветки. На мобильных устройствах (экраны шириной менее 768px) окно чата всегда отображается во весь экран для лучшей удобства использования.

### Chat Window Dimensions

Окна чата имеют ширину 410px на настольных компьютерах с отступом 20px и визуальной стрелкой длиной 16px, указывающей на выделенный текст. Эти размеры фиксированы для обеспечения предсказуемого поведения, но вы можете настроить внешний вид с помощью CSS.

### Cross-Element Selections

Пользователи могут выделять текст, который пересекает несколько HTML-элементов, например, от середины одного абзаца до начала другого. Система сериализации диапазонов корректно обрабатывает это и подсветит весь выбранный текст даже через границы элементов.

### Browser Compatibility

Система выделения текста использует стандартный API `window.getSelection()`, который поддерживается во всех современных браузерах. Для старых версий Internet Explorer предусмотрен откат на `document.selection` для совместимости.

### Selection Persistence

После создания разговора для выделенного текста эта аннотация сохраняется даже после перезагрузки страницы. Сериализованный диапазон и путь DOM позволяют виджету восстановить подсветки в точно том же месте, когда пользователи возвращаются на страницу.

Это работает надёжно при условии, что содержимое вашей страницы остаётся стабильным. Если вы измените текстовое содержимое или перестроите HTML, существующие аннотации могут больше не совпадать с текстом. По этой причине лучше избегать крупных изменений контента на страницах с активными аннотациями или рассмотреть возможность миграции аннотаций, когда изменения контента необходимы.