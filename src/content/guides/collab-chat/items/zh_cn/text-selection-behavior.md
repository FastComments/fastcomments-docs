### How Text Selection Works

当用户在 Collab Chat 容器内选中文本时，小部件会捕获该选区并允许他们发起讨论。选区可以小到一个单词，也可以大到跨越不同元素的多段文本。

### Selection Delay

在桌面设备上，用户选中文本与讨论提示出现之间有 3.5 秒的延迟。这可以防止当用户仅仅高亮文本以复制或阅读时界面闪烁。在移动设备上，由于触摸屏上的文本选择更为刻意，提示会立即出现。


### Unique Conversation IDs

每个会话都会得到一个唯一的 `urlId`，它将页面 URL、DOM 元素路径和序列化的文本范围组合在一起。这确保每个文本选区都会创建一个可以稍后再次找到的唯一会话。

如果你在配置中提供了自定义的 `urlId`，它将与元素路径和文本范围组合以创建最终标识符。

### Visual Highlights

当某个文本选区存在讨论时，该文本会获得视觉高亮。高亮通过背景颜色实现，并在悬停或相关聊天窗口打开时显示。

高亮系统的实现方式是将所选文本包装在一个可以应用样式的特殊元素中。这种方法确保即使底层 HTML 结构复杂，高亮也能保持准确。

### Chat Window Positioning

当用户点击高亮或创建新的注释时，聊天窗口会出现在选中文本附近。小部件会基于可用的视口空间自动计算该窗口的最佳位置。

定位系统使用像 `to-right`、`to-left`、`to-top` 和 `to-bottom` 这样的 CSS 类来指示聊天窗口应从高亮处向哪个方向展开。在移动设备（屏幕宽度小于 768px）上，聊天窗口始终以全屏形式显示，以提升可用性。

### Chat Window Dimensions

在桌面端，聊天窗口宽度为 410px，带有 20px 的间距和一个指向高亮文本的 16px 视觉箭头。这些尺寸是固定的以确保一致的行为，但你可以使用 CSS 自定义外观。

### Cross-Element Selections

用户可以选中跨越多个 HTML 元素的文本，例如从一段的中间高亮到另一段的开头。范围序列化系统可以正确处理这种情况，并会高亮所有被选中的文本，即使跨越元素边界。

### Browser Compatibility

文本选择系统使用标准的 `window.getSelection()` API，该 API 在所有现代浏览器中受支持。对于旧版本的 Internet Explorer，会回退到 `document.selection` 以保证兼容性。

### Selection Persistence

一旦为某个文本选区创建了会话，该注释即使在页面重新加载后也会保留。序列化的范围和 DOM 路径允许小部件在用户返回页面时将高亮恢复到完全相同的位置。

只要你的页面内容保持稳定，这个功能就能可靠工作。如果你更改了文本内容或重构了 HTML，现有注释可能不再与文本对齐。因此，最好在有活动注释的页面上避免重大内容更改，或者在必须更改内容时考虑迁移注释。