### Ажурирања у реалном времену

Collab Chat користи WebSocket везе за синхронизацију свих разговора у реалном времену међу свим повезаним корисницима. Када неко направи нову анотацију, дода коментар или обрише дискусију, сви остали корисници који гледају исту страницу виде ажурирање одмах без освежења.

### Како ради синхронизација преко WebSocket-а

Када иницијализујете Collab Chat, видгет успоставља WebSocket везу са FastComments серверима. Ова веза остаје отворена током корисничке сесије и слуша ажурирања везана за текућу страницу.

WebSocket систем користи три типа broadcast порука за Collab Chat. The `new-text-chat` догађај се активира када неко направи нову анотацију на страници. The `updated-text-chat` догађај се активира када неко ажурира постојећу конверзацију. The `deleted-text-chat` догађај се активира када неко обрише анотацију.

### Broadcast ID System

Да би се спречили ефекти еха где корисници виде своје акције које им се враћају назад, свака измена укључује јединствени `broadcastId`. Када корисник креира или ажурира анотацију, њихов клијент генерише UUID за ту операцију. Када WebSocket емитује ажурирање назад свим клијентима, изворни клијент игнорише ажурирање јер се поклапа са његовим `broadcastId`.

Ово обезбеђује глатку интеракцију где корисници виде своје измене одмах у корисничком интерфејсу без чекања на рунд-трип преко сервера, а истовремено осигурава да сви остали корисници добију ажурирање.

### Број корисника уживо

Горња трака приказује број корисника који тренутно гледају страницу. Овај број се ажурира у реалном времену како корисници приступају и напуштају страницу. Број корисника се обезбеђује преко исте WebSocket везе и аутоматски се увећава/смањује на основу догађаја повезивања и прекида везе.

### Отпорност везе

Ако WebSocket веза падне услед мрежних проблема или одржавања сервера, видгет аутоматски покушава поновно успостављање везе. Током периода поновног повезивања, корисници и даље могу да интерагују са постојећим анотацијама, али неће видети ажурирања у реалном времену од других корисника док се веза не поново успостави.

Када се веза поново успостави, видгет синхронизује стање како би осигурао да нису пропуштена никаква ажурирања. Ово се дешава транспарентно без потребе за интервенцијом корисника.

### Напомене о пропусном опсегу

WebSocket поруке су лагане и садрже само основне информације потребне за синхронизацију стања. Креирање нове анотације обично користи мање од 1KB пропусног опсега. Систем такође укључује интелигентно груписање порука како би се смањила учесталост порука током периода високе активности.

Ваше метрике коришћења у FastComments контролној табли прате `pubSubMessageCount` и `pubSubBandwidth` тако да можете пратити активност синхронизације у реалном времену на вашим сајтовима.

### Синхронизација између картица

Ако корисник има исту страницу отворену у више прегледачких картица, ажурирања у једној картици појављују се одмах у другим картицама. Ово функционише кроз исти WebSocket механизам синхронизације и не захтева додатну конфигурацију.

### Безбедност

WebSocket поруке се преносе преко сигурних веза (WSS) и укључују валидацију тенанта како би се осигурало да корисници примају само ажурирања за конверзације за које су овлашћени. Сервер валидаује све операције пре него што их емитује како би спречио неовлашћен приступ или манипулацију.