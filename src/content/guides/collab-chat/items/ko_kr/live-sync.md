### Real-Time Updates

Collab Chat는 WebSocket 연결을 사용하여 모든 대화를 실시간으로 동기화합니다. 누군가 새 주석을 작성하거나 댓글을 추가하거나 토론을 삭제하면 같은 페이지를 보고 있는 다른 모든 사용자는 새로고침 없이 즉시 업데이트를 확인합니다.

### How WebSocket Sync Works

Collab Chat를 초기화하면 위젯은 FastComments 서버에 WebSocket 연결을 설정합니다. 이 연결은 사용자의 세션 동안 열려 있으며 현재 페이지와 관련된 업데이트를 수신 대기합니다.

WebSocket 시스템은 Collab Chat에 대해 세 가지 유형의 브로드캐스트 메시지를 사용합니다. `new-text-chat` 이벤트는 누군가 페이지에 새 주석을 작성할 때 발생합니다. `updated-text-chat` 이벤트는 누군가 기존 대화를 업데이트할 때 발생합니다. `deleted-text-chat` 이벤트는 누군가 주석을 삭제할 때 발생합니다.

### Broadcast ID System

사용자가 자신의 동작이 다시 브로드캐스트되어 자신에게 되돌아오는 에코 효과를 방지하기 위해 각 업데이트에는 고유한 `broadcastId`가 포함됩니다. 사용자가 주석을 생성하거나 업데이트할 때 해당 클라이언트는 해당 작업에 대한 UUID를 생성합니다. WebSocket이 업데이트를 모든 클라이언트에 브로드캐스트하면, 원래 작업을 수행한 클라이언트는 자신의 `broadcastId`와 일치하기 때문에 해당 업데이트를 무시합니다.

이것은 사용자가 서버를 통한 왕복을 기다리지 않고도 UI에서 변경사항을 즉시 확인할 수 있도록 하면서도 다른 모든 사용자가 업데이트를 받도록 보장하여 원활한 상호작용을 제공합니다.

### Live User Count

상단 바에는 현재 페이지를 보고 있는 사용자 수가 표시됩니다. 이 수치는 사용자가 들어오고 나감에 따라 실시간으로 업데이트됩니다. 사용자 수는 동일한 WebSocket 연결을 통해 제공되며 연결 및 연결 해제 이벤트에 따라 자동으로 증가/감소합니다.

### Connection Resilience

네트워크 문제나 서버 유지 관리로 인해 WebSocket 연결이 끊어지면 위젯은 자동으로 다시 연결을 시도합니다. 재연결 기간 동안 사용자는 기존 주석과 상호작용할 수는 있지만 연결이 복구될 때까지 다른 사용자의 실시간 업데이트는 볼 수 없습니다.

다시 연결되면 위젯은 놓친 업데이트가 없는지 재동기화합니다. 이는 사용자의 개입 없이 투명하게 이루어집니다.

### Bandwidth Considerations

WebSocket 메시지는 경량이며 상태를 동기화하는 데 필요한 최소한의 정보만 포함합니다. 새 주석을 만드는 데 일반적으로 1KB 미만의 대역폭이 사용됩니다. 시스템에는 활동이 많은 기간 동안 메시지 빈도를 줄이기 위한 지능형 배칭도 포함되어 있습니다.

FastComments 대시보드의 사용량 지표는 `pubSubMessageCount` 및 `pubSubBandwidth`를 추적하므로 사이트 전반의 실시간 동기화 활동을 모니터링할 수 있습니다.

### Cross-Tab Synchronization

사용자가 동일한 페이지를 여러 브라우저 탭에서 열어둔 경우 한 탭에서의 업데이트는 다른 탭에 즉시 표시됩니다. 이는 동일한 WebSocket 동기화 메커니즘을 통해 작동하며 별도의 추가 구성은 필요하지 않습니다.

### Security

WebSocket 메시지는 보안 연결(WSS)을 통해 전송되며 사용자가 권한이 있는 대화에 대한 업데이트만 수신하도록 테넌트 검증을 포함합니다. 서버는 무단 액세스나 조작을 방지하기 위해 브로드캐스트하기 전에 모든 작업을 검증합니다.