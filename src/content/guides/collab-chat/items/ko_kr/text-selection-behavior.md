### How Text Selection Works

사용자가 Collab Chat 컨테이너 내에서 텍스트를 선택하면, 위젯은 그 선택을 캡처하여 토론을 시작할 수 있게 합니다. 선택은 한 단어만큼 작을 수도 있고 서로 다른 요소에 걸친 여러 단락만큼 클 수도 있습니다.

### Selection Delay

데스크톱 장치에서는 사용자가 텍스트를 선택한 시점과 토론 프롬프트가 나타나는 시점 사이에 3.5초의 지연이 있습니다. 이는 사용자가 단순히 텍스트를 복사하거나 읽기 위해 강조 표시할 때 UI가 깜빡이는 것을 방지합니다. 모바일 기기에서는 터치 스크린에서의 텍스트 선택이 더 의도적이므로 프롬프트가 즉시 나타납니다.

### Unique Conversation IDs

각 대화는 페이지 URL, DOM 요소 경로 및 직렬화된 텍스트 범위를 결합한 고유한 `urlId`를 부여받습니다. 이는 각 텍스트 선택이 나중에 다시 찾을 수 있는 별도의 대화를 생성하도록 보장합니다.

구성에서 사용자 지정 `urlId`를 제공하면, 최종 식별자를 만들기 위해 요소 경로 및 텍스트 범위와 결합됩니다.

### Visual Highlights

특정 텍스트 선택에 대한 토론이 존재하면 해당 텍스트에 시각적 하이라이트가 적용됩니다. 하이라이트는 배경색을 사용하여 구현되며, 마우스를 올리거나 연결된 채팅 창이 열려 있을 때 나타납니다.

하이라이트 시스템은 선택된 텍스트를 스타일을 적용할 수 있는 특수 요소로 래핑하여 작동합니다. 이 접근 방식은 기본 HTML 구조가 복잡하더라도 하이라이트가 정확하게 유지되도록 보장합니다.

### Chat Window Positioning

사용자가 하이라이트를 클릭하거나 새 주석을 생성하면 선택된 텍스트 근처에 채팅 창이 나타납니다. 위젯은 사용 가능한 뷰포트 공간을 기준으로 이 창의 최적 위치를 자동으로 계산합니다.

위치 지정 시스템은 채팅 창이 하이라이트에서 어느 방향으로 확장되어야 하는지를 나타내기 위해 `to-right`, `to-left`, `to-top`, `to-bottom`과 같은 CSS 클래스를 사용합니다. 모바일 기기(너비가 768px 미만인 화면)에서는 더 나은 사용성을 위해 채팅 창이 항상 전체 화면으로 표시됩니다.

### Chat Window Dimensions

데스크톱에서는 채팅 창의 너비가 410px이고 20px 간격과 하이라이트된 텍스트를 가리키는 16px 크기의 시각적 화살표가 있습니다. 이러한 치수는 일관된 동작을 보장하기 위해 고정되어 있지만 CSS로 외형을 사용자화할 수 있습니다.

### Cross-Element Selections

사용자는 하나의 단락 중간에서 다른 단락의 시작까지 하이라이트하는 등 여러 HTML 요소에 걸쳐 텍스트를 선택할 수 있습니다. 범위 직렬화 시스템은 이를 올바르게 처리하며 요소 경계를 넘는 모든 선택된 텍스트를 하이라이트합니다.

### Browser Compatibility

텍스트 선택 시스템은 모든 최신 브라우저에서 지원되는 표준 `window.getSelection()` API를 사용합니다. 구형 Internet Explorer 버전에서는 호환성을 위해 `document.selection`으로 폴백됩니다.

### Selection Persistence

텍스트 선택에 대한 대화가 생성되면 해당 주석은 페이지를 새로고침해도 지속됩니다. 직렬화된 범위와 DOM 경로를 통해 사용자가 페이지를 다시 방문했을 때 위젯이 정확히 동일한 위치에 하이라이트를 복원할 수 있습니다.

이 기능은 페이지 콘텐츠가 안정적으로 유지되는 한 신뢰할 수 있습니다. 텍스트 내용을 변경하거나 HTML을 재구성하면 기존 주석이 더 이상 텍스트와 정확히 일치하지 않을 수 있습니다. 이러한 이유로 활성 주석이 있는 페이지에서는 대규모 콘텐츠 변경을 피하거나, 콘텐츠 변경이 불가피한 경우 주석을 마이그레이션하는 방안을 고려하는 것이 좋습니다.