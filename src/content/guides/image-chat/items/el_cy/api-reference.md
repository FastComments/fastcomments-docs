### Επισκόπηση API

Το Image Chat παρέχει τρία σημεία τερματισμού REST API για τη διαχείριση συνομιλιών εικόνας προγραμματιστικά. Αυτά τα σημεία τερματισμού σας επιτρέπουν να ανακτάτε, να δημιουργείτε και να διαγράφετε δείκτες χωρίς τη χρήση του widget του προγράμματος περιήγησης.

Όλα τα σημεία τερματισμού API απαιτούν ταυτοποίηση και ακολουθούν τα πρότυπα του FastComments API. Πρόκειται για δημόσια σημεία τερματισμού που πραγματοποιούν έλεγχο ταυτότητας μέσω cookie του προγράμματος περιήγησης, όχι μέσω API keys.

### Βασικό URL

Όλα τα σημεία τερματισμού του Image Chat βρίσκονται κάτω από:

```
https://fastcomments.com/comment-image-chats
```

### Ταυτοποίηση

Αυτά τα σημεία τερματισμού πραγματοποιούν έλεγχο ταυτότητας των χρηστών μέσω cookie του προγράμματος περιήγησης. Δεν χρησιμοποιούν API keys. Οι χρήστες πρέπει να είναι συνδεδεμένοι στο FastComments στο πρόγραμμα περιήγησής τους για να έχουν πρόσβαση σε αυτά τα σημεία τερματισμού.

### Λήψη όλων των συνομιλιών

Ανάκτηση όλων των συνομιλιών εικόνας για μια συγκεκριμένη εικόνα.

#### Endpoint

```
GET /comment-image-chats/:tenantId?urlId=<urlId>
```

#### Παράμετροι

`tenantId` (παράμετρος διαδρομής, απαιτείται) είναι το Tenant ID του FastComments σας.

`urlId` (παράμετρος ερωτήματος, απαιτείται) είναι το αναγνωριστικό της εικόνας για την οποία θέλετε να ανακτήσετε συνομιλίες.

#### Απόκριση

Η απόκριση περιλαμβάνει την κατάσταση του API, πληροφορίες για τη συνεδρία του τρέχοντος χρήστη αν έχει πραγματοποιηθεί ταυτοποίηση, έναν πίνακα συνομιλιών με τα IDs τους, URLs και συντεταγμένες X/Y, ένα καθαρισμένο αναγνωριστικό URL, μια ένδειξη αν ο τρέχων χρήστης είναι διαχειριστής ή συντονιστής της ιστοσελίδας, και λεπτομέρειες σύνδεσης WebSocket για ζωντανή συγχρονισμό συμπεριλαμβανομένων των `tenantIdWS`, `urlIdWS`, και `userIdWS`.

#### Παράδειγμα αιτήματος

```bash
curl "https://fastcomments.com/comment-image-chats/demo?urlId=my-product-image" \
  --cookie "your-session-cookie"
```

#### Παράδειγμα απάντησης

```json
{
  "status": "success",
  "user": {
    "id": "user123",
    "username": "john_doe"
  },
  "conversations": [
    {
      "_id": "conv123",
      "urlId": "my-product-image:/images/product.jpg:25:30",
      "x": 25.5,
      "y": 30.2
    },
    {
      "_id": "conv456",
      "urlId": "my-product-image:/images/product.jpg:60:45",
      "x": 60.8,
      "y": 45.1
    }
  ],
  "urlIdClean": "my-product-image",
  "isSiteAdmin": false,
  "tenantIdWS": "demo",
  "urlIdWS": "my-product-image",
  "userIdWS": "user123"
}
```

### Δημιουργία συνομιλίας

Δημιουργία νέας συνομιλίας εικόνας για μια συγκεκριμένη θέση πάνω σε μια εικόνα.

#### Endpoint

```
POST /comment-image-chats/:tenantId
```

#### Παράμετροι

`tenantId` (παράμετρος διαδρομής, απαιτείται) είναι το Tenant ID του FastComments σας.

Το σώμα του αιτήματος πρέπει να είναι JSON και να περιλαμβάνει τα ακόλουθα απαιτούμενα πεδία.

`urlId` (string, απαιτείται) είναι το βασικό αναγνωριστικό της σελίδας.

`windowUrlId` (string, απαιτείται) είναι το URL σε συνδυασμό με την πηγή της εικόνας και τις συντεταγμένες, για παράδειγμα `my-page:/images/photo.jpg:25.5:30.2`.

`pageTitle` (string, απαιτείται) είναι ο τίτλος της σελίδας.

`src` (string, απαιτείται) είναι το URL της πηγής της εικόνας.

`x` (number, απαιτείται) είναι η συντεταγμένη X ως ποσοστό (0-100).

`y` (number, απαιτείται) είναι η συντεταγμένη Y ως ποσοστό (0-100).

`createdFromCommentId` (string, απαιτείται) είναι το ID του σχολίου που ξεκίνησε αυτή τη συνομιλία.

`broadcastId` (string, απαιτείται) είναι ένα UUID για τον ζωντανό συγχρονισμό ώστε να αποφεύγονται εφέ ηχώ.

#### Απόκριση

Η απόκριση περιλαμβάνει την κατάσταση του API και το ID της νεοδημιουργημένης συνομιλίας.

#### Παράδειγμα αιτήματος

```bash
curl -X POST "https://fastcomments.com/comment-image-chats/demo" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "urlId": "my-product-image",
    "windowUrlId": "my-product-image:/images/product.jpg:25.5:30.2",
    "pageTitle": "Product Gallery",
    "src": "/images/product.jpg",
    "x": 25.5,
    "y": 30.2,
    "createdFromCommentId": "comment789",
    "broadcastId": "550e8400-e29b-41d4-a716-446655440000"
  }'
```

#### Παράδειγμα απάντησης

```json
{
  "status": "success",
  "createdChatId": "conv789"
}
```

### Διαγραφή συνομιλίας

Διαγραφή υπάρχουσας συνομιλίας εικόνας. Αυτό το σημείο τερματισμού απαιτεί δικαιώματα διαχειριστή ή συντονιστή, ή η συνομιλία πρέπει να έχει δημιουργηθεί από τον ταυτοποιημένο χρήστη.

#### Endpoint

```
DELETE /comment-image-chats/:tenantId/:chatId
```

#### Παράμετροι

`tenantId` (παράμετρος διαδρομής, απαιτείται) είναι το Tenant ID του FastComments σας.

`chatId` (παράμετρος διαδρομής, απαιτείται) είναι το ID της συνομιλίας που θα διαγραφεί.

`broadcastId` (σώμα αιτήματος, απαιτείται) είναι ένα UUID για τον ζωντανό συγχρονισμό.

#### Παράδειγμα αιτήματος

```bash
curl -X DELETE "https://fastcomments.com/comment-image-chats/demo/conv789" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "broadcastId": "550e8400-e29b-41d4-a716-446655440001"
  }'
```

#### Παράδειγμα απάντησης

```json
{
  "status": "success"
}
```

### Σύστημα συντεταγμένων

Οι συντεταγμένες X και Y αποθηκεύονται ως ποσοστά των διαστάσεων της εικόνας. Το X αντιπροσωπεύει τη οριζόντια θέση από την αριστερή άκρη (0 = αριστερή άκρη, 100 = δεξιά άκρη). Το Y αντιπροσωπεύει τη κάθετη θέση από την κορυφή (0 = κορυφή, 100 = κάτω).

Αυτές οι τιμές ποσοστού μπορούν να περιλαμβάνουν δεκαδικά για μεγαλύτερη ακρίβεια. Για παράδειγμα, x: 25.5 σημαίνει 25.5% από την αριστερή άκρη της εικόνας.

### Περιορισμός ρυθμού αιτήσεων

Αυτά τα σημεία τερματισμού υπόκεινται στον τυπικό περιορισμό ρυθμού του FastComments API. Το middleware περιορισμού ρυθμού εφαρμόζεται ανά tenant για να αποτρέψει καταχρήσεις ενώ επιτρέπει κανονικά μοτίβα χρήσης.

### Απαντήσεις σφάλματος

Όλα τα σημεία τερματισμού επιστρέφουν τυπικούς HTTP κωδικούς κατάστασης. Μια απόκριση 400 υποδεικνύει μη έγκυρες παραμέτρους αιτήματος. Μια απόκριση 401 σημαίνει αποτυχία ταυτοποίησης. Μια απόκριση 403 υποδεικνύει ανεπαρκή δικαιώματα. Μια απόκριση 404 σημαίνει ότι η συνομιλία δεν βρέθηκε. Μια απόκριση 429 υποδεικνύει υπέρβαση του ορίου ρυθμού.

Οι απαντήσεις σφάλματος περιλαμβάνουν σώμα JSON με λεπτομέρειες:

```json
{
  "status": "error",
  "message": "Conversation not found"
}
```

### Παρακολούθηση χρήσης

Η δημιουργία συνομιλιών αυξάνει τον usage δείκτη `conversationCreateCount`. Όλη η δραστηριότητα συγχρονισμού WebSocket αυξάνει τα `pubSubMessageCount` και `pubSubBandwidth`. Μπορείτε να παρακολουθείτε αυτούς τους μετρητές στον πίνακα ελέγχου του FastComments υπό τα analytics χρήσης.