### パーセンテージベースの位置指定

Image Chat は、画像上のチャットマーカーを配置するためにピクセル座標ではなくパーセンテージベースの座標を使用します。ユーザーが画像をクリックすると、ウィジェットはクリックのピクセル座標を画像の幅と高さに対するパーセンテージに変換します。この方法により、画像の表示方法に関係なくマーカーが正しい位置に保持されます。

例えば、ユーザーが幅1000pxの画像の左端から250ピクセルの位置をクリックした場合、ウィジェットはこれを左から25%として保存します。別のユーザーが同じ画像をモバイル端末で幅500pxで表示すると、マーカーは左から125ピクセルの位置に表示されますが、それは幅の25%に相当します。

### レスポンシブレイアウトにおける利点

このパーセンテージ方式により、Image Chat はすべてのデバイスサイズと向きでシームレスに動作します。画像は画面幅、CSSルール、またはコンテナの制約に応じて異なるサイズで表示されることがありますが、マーカーは常に意図した位置に正しく揃います。

大きなモニターを使うデスクトップユーザーも、小さな画面のスマートフォンユーザーも、マーカーは同じ相対的な位置に表示されます。マーカーは画像自体とともに比例してスケールします。

### 画像のスケーリングとアスペクト比

画像がスケーリング時にアスペクト比を維持している限り（これはブラウザのデフォルト動作です）、パーセンテージベースのマーカーは完全に整列したままになります。ウィジェットは画像が比例してスケールすると仮定して位置を計算します。

もし `object-fit: cover` のように特定の寸法で画像のアスペクト比を歪めるような CSS を適用すると、マーカーの位置が正しく揃わない場合があります。最良の結果を得るには、画像を自然にスケールさせるか、アスペクト比を維持するために `object-fit: contain` を使用してください。

### チャット四角のサイズ指定

チャットマーカーの視覚的な大きさもパーセンテージベースです。`chatSquarePercentage` 設定オプションはデフォルトで5%になっており、各四角は画像幅の5%になります。これにより、異なる画像サイズ間で視覚的な大きさが一貫します。

幅1000pxの画像でデフォルトの5%設定を使用すると、マーカーは50px四方になります。幅500pxの画像では、同じマーカーは25px四方になります。これらは画像サイズに対して比例したままです。

### モバイルでの挙動

幅が768px未満の画面では、Image Chat はモバイル最適化レイアウトに切り替わります。チャットウィンドウはマーカーの横に浮かぶのではなく全画面で開きます。これは、浮動するウィンドウが画像を過度に遮ってしまう小さな画面での使いやすさを向上させます。

マーカー自体はパーセンテージベースの位置に表示され、クリック可能なままです。ユーザーはディスカッションの位置を確認し、マーカーをタップして全画面のチャットインターフェースを開くことができます。

### 動的な画像読み込み

画像が非同期で読み込まれたりページ読み込み後にサイズが変わったりしても、パーセンテージベースのシステムは正しく機能します。ウィジェットは画像要素を監視し、画像の寸法が変わるたびにマーカー位置を再計算します。

遅延読み込みを行っている場合や、ブレークポイントごとに異なるサイズのレスポンシブ画像を実装している場合でも、画像サイズが変わるとマーカーは自動的に調整されます。

### デバイス間での一貫性

座標がデータベースにパーセンテージとして保存されるため、デスクトップで作成されたディスカッションはタブレットや電話で表示しても同じ相対位置に表示されます。ユーザーはデバイスを跨いで協力しても位置の不整合が発生しません。

これは双方向に機能します。モバイルデバイスで特定のスポットをタップして作成されたディスカッションは、大きなデスクトップモニターで表示しても同じ相対位置に表示されます。

### ビューポートに関する考慮

ウィジェットはパーセンテージをビューポートではなく画像要素自体に対して計算します。つまり、ページをスクロールしたりブラウザウィンドウのサイズを変更したりしてもマーカーの位置には影響しません。マーカーはビューポートの変更に関係なく画像上の位置に固定されます。

### 将来への備え

パーセンテージベースのアプローチにより、レイアウト、デザイン、デバイス環境の変化に対して画像ディスカッションは強靭になります。新しい画面サイズやデバイスが登場しても、既存のディスカッションは更新や移行を必要とせず正しく表示され続けます。