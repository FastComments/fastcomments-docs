### Преглед на API

Чат за изображения (Image Chat) предоставя три REST API крайни точки за управление на разговори за изображения програмно. Тези крайни точки ви позволяват да извличате, създавате и изтривате маркери без използване на браузърния widget.

Всички API крайни точки изискват автентикация и следват стандартните модели на FastComments API. Това са публични крайни точки, които се удостоверяват чрез браузърни бисквитки, а не чрез API ключове.

### Базов URL

Всички Image Chat API крайни точки са под:

```
https://fastcomments.com/comment-image-chats
```

### Автентикация

Тези крайни точки удостоверяват потребителите чрез браузърни бисквитки. Те не използват API ключове. Потребителите трябва да са влезли в FastComments в своя браузър, за да имат достъп до тези крайни точки.

### Получаване на всички разговори

Извличане на всички разговори за конкретно изображение.

#### Крайна точка

```
GET /comment-image-chats/:tenantId?urlId=<urlId>
```

#### Параметри

`tenantId` (параметър в пътя, задължителен) е вашият FastComments Tenant ID.

`urlId` (query параметър, задължителен) е идентификаторът на изображението, за което искате да извлечете разговорите.

#### Отговор

Отговорът включва статуса на API, информация за сесията на текущия потребител ако е удостоверен, масив от разговори със техните идентификатори, URL адреси и X/Y координати, почистен URL идентификатор, флаг, указващ дали текущият потребител е администратор на сайта или модератор, и детайли за WebSocket връзката за синхронизация в реално време включително `tenantIdWS`, `urlIdWS`, и `userIdWS`.

#### Примерен заявка

```bash
curl "https://fastcomments.com/comment-image-chats/demo?urlId=my-product-image" \
  --cookie "your-session-cookie"
```

#### Примерен отговор

```json
{
  "status": "success",
  "user": {
    "id": "user123",
    "username": "john_doe"
  },
  "conversations": [
    {
      "_id": "conv123",
      "urlId": "my-product-image:/images/product.jpg:25:30",
      "x": 25.5,
      "y": 30.2
    },
    {
      "_id": "conv456",
      "urlId": "my-product-image:/images/product.jpg:60:45",
      "x": 60.8,
      "y": 45.1
    }
  ],
  "urlIdClean": "my-product-image",
  "isSiteAdmin": false,
  "tenantIdWS": "demo",
  "urlIdWS": "my-product-image",
  "userIdWS": "user123"
}
```

### Създаване на разговор

Създаване на нов разговор за изображение за конкретно място върху изображението.

#### Крайна точка

```
POST /comment-image-chats/:tenantId
```

#### Параметри

`tenantId` (параметър в пътя, задължителен) е вашият FastComments Tenant ID.

Тялото на заявката трябва да е JSON и да включва следните задължителни полета.

`urlId` (string, задължително) е базовият идентификатор на страницата.

`windowUrlId` (string, задължително) е URL комбиниран с източника на изображението и координатите, например `my-page:/images/photo.jpg:25.5:30.2`.

`pageTitle` (string, задължително) е заглавието на страницата.

`src` (string, задължително) е URL на източника на изображението.

`x` (number, задължително) е X координатата като процент (0-100).

`y` (number, задължително) е Y координатата като процент (0-100).

`createdFromCommentId` (string, задължително) е ID-то на коментара, който е инициирал този чат.

`broadcastId` (string, задължително) е UUID за синхронизация в реално време, за да се предотвратят ефекти на ехо.

#### Отговор

Отговорът включва статуса на API и ID-то на новосъздадения разговор.

#### Примерен заявка

```bash
curl -X POST "https://fastcomments.com/comment-image-chats/demo" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "urlId": "my-product-image",
    "windowUrlId": "my-product-image:/images/product.jpg:25.5:30.2",
    "pageTitle": "Product Gallery",
    "src": "/images/product.jpg",
    "x": 25.5,
    "y": 30.2,
    "createdFromCommentId": "comment789",
    "broadcastId": "550e8400-e29b-41d4-a716-446655440000"
  }'
```

#### Примерен отговор

```json
{
  "status": "success",
  "createdChatId": "conv789"
}
```

### Изтриване на разговор

Изтриване на съществуващ разговор за изображение. Тази крайна точка изисква права на администратор или модератор, или разговорът да е бил създаден от удостоверения потребител.

#### Крайна точка

```
DELETE /comment-image-chats/:tenantId/:chatId
```

#### Параметри

`tenantId` (параметър в пътя, задължителен) е вашият FastComments Tenant ID.

`chatId` (параметър в пътя, задължителен) е ID-то на разговора, който ще бъде изтрит.

`broadcastId` (тяло на заявката, задължително) е UUID за синхронизация в реално време.

#### Примерен заявка

```bash
curl -X DELETE "https://fastcomments.com/comment-image-chats/demo/conv789" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "broadcastId": "550e8400-e29b-41d4-a716-446655440001"
  }'
```

#### Примерен отговор

```json
{
  "status": "success"
}
```

### Система на координатите

X и Y координатите се съхраняват като проценти от размерите на изображението. X представлява хоризонталната позиция от лявата страна (0 = ляв ръб, 100 = десен ръб). Y представлява вертикалната позиция от горната страна (0 = горен ръб, 100 = долен ръб).

Тези процентни стойности могат да включват десетични числа за по-голяма точност. Например, x: 25.5 означава 25.5% от разстоянието от лявия ръб на изображението.

### Ограничение на честотата на заявките

Тези крайни точки подлежат на стандартното ограничение на честотата на FastComments API. Middleware за ограничение на честотата се прилага на ниво tenant, за да се предотврати злоупотреба, докато позволява нормални модели на използване.

### Грешки в отговорите

Всички крайни точки връщат стандартни HTTP статус кодове. 400 отговор указва невалидни параметри на заявката. 401 отговор означава, че автентикацията е неуспешна. 403 отговор указва недостатъчни права. 404 отговор означава, че разговорът не е намерен. 429 отговор указва превишаване на лимита за заявки.

Грешките в отговорите включват JSON тяло с детайли:

```json
{
  "status": "error",
  "message": "Conversation not found"
}
```

### Проследяване на употребата

Създаването на разговори увеличава вашата метрика за употреба `conversationCreateCount`. Всяка WebSocket синхронизация увеличава `pubSubMessageCount` и `pubSubBandwidth`. Можете да наблюдавате тези метрики в таблото за управление на FastComments под аналитика за употреба.