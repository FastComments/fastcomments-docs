### Επισκόπηση API

Το Image Chat παρέχει τρία REST API endpoints για τη διαχείριση συνομιλιών εικόνας προγραμματικά. Αυτά τα endpoints σας επιτρέπουν να ανακτήσετε, να δημιουργήσετε και να διαγράψετε σημεία σήμανσης χωρίς να χρησιμοποιήσετε το widget του προγράμματος περιήγησης.

Όλα τα API endpoints απαιτούν αυθεντικοποίηση και ακολουθούν τα τυπικά πρότυπα του FastComments API. Πρόκειται για δημόσια endpoints που αυθεντικοποιούν μέσω cookies του προγράμματος περιήγησης, όχι μέσω API keys.

### Βασικό URL

Όλα τα API endpoints για το Image Chat βρίσκονται κάτω από:

```
https://fastcomments.com/comment-image-chats
```

### Αυθεντικοποίηση

Αυτά τα endpoints αυθεντικοποιούν τους χρήστες μέσω cookies του προγράμματος περιήγησης. Δεν χρησιμοποιούν API keys. Οι χρήστες πρέπει να είναι συνδεδεμένοι στο FastComments στο πρόγραμμα περιήγησής τους για να αποκτήσουν πρόσβαση σε αυτά τα endpoints.

### Λήψη όλων των συνομιλιών

Ανακτήστε όλες τις συνομιλίες εικόνας για μια συγκεκριμένη εικόνα.

#### Endpoint

```
GET /comment-image-chats/:tenantId?urlId=<urlId>
```

#### Παράμετροι

`tenantId` (παράμετρος διαδρομής, υποχρεωτική) είναι το FastComments Tenant ID σας.

`urlId` (παράμετρος ερωτήματος, υποχρεωτική) είναι ο αναγνωριστής της εικόνας για την οποία θέλετε να ανακτήσετε τις συνομιλίες.

#### Απόκριση

Η απόκριση περιλαμβάνει την κατάσταση του API, πληροφορίες για την τρέχουσα συνεδρία χρήστη εάν υπάρχει αυθεντικοποίηση, έναν πίνακα συνομιλιών με τα IDs τους, τα URL και τις συντεταγμένες X/Y, έναν καθαρισμένο αναγνωριστή URL, μία σημαία που υποδεικνύει εάν ο τρέχων χρήστης είναι διαχειριστής ιστότοπου ή moderator, και λεπτομέρειες σύνδεσης WebSocket για συγχρονισμό σε πραγματικό χρόνο συμπεριλαμβανομένων των `tenantIdWS`, `urlIdWS`, και `userIdWS`.

#### Παράδειγμα αιτήματος

```bash
curl "https://fastcomments.com/comment-image-chats/demo?urlId=my-product-image" \
  --cookie "your-session-cookie"
```

#### Παράδειγμα απόκρισης

```json
{
  "status": "success",
  "user": {
    "id": "user123",
    "username": "john_doe"
  },
  "conversations": [
    {
      "_id": "conv123",
      "urlId": "my-product-image:/images/product.jpg:25:30",
      "x": 25.5,
      "y": 30.2
    },
    {
      "_id": "conv456",
      "urlId": "my-product-image:/images/product.jpg:60:45",
      "x": 60.8,
      "y": 45.1
    }
  ],
  "urlIdClean": "my-product-image",
  "isSiteAdmin": false,
  "tenantIdWS": "demo",
  "urlIdWS": "my-product-image",
  "userIdWS": "user123"
}
```

### Δημιουργία συνομιλίας

Δημιουργήστε μια νέα συνομιλία εικόνας για μια συγκεκριμένη θέση στην εικόνα.

#### Endpoint

```
POST /comment-image-chats/:tenantId
```

#### Παράμετροι

`tenantId` (παράμετρος διαδρομής, υποχρεωτική) είναι το FastComments Tenant ID σας.

Το σώμα του αιτήματος πρέπει να είναι JSON και να περιλαμβάνει τα ακόλουθα υποχρεωτικά πεδία.

`urlId` (string, required) είναι ο βασικός αναγνωριστής της σελίδας.

`windowUrlId` (string, required) είναι το URL σε συνδυασμό με την πηγή της εικόνας και τις συντεταγμένες, για παράδειγμα `my-page:/images/photo.jpg:25.5:30.2`.

`pageTitle` (string, required) είναι ο τίτλος της σελίδας.

`src` (string, required) είναι το URL πηγής της εικόνας.

`x` (number, required) είναι η συντεταγμένη X ως ποσοστό (0-100).

`y` (number, required) είναι η συντεταγμένη Y ως ποσοστό (0-100).

`createdFromCommentId` (string, required) είναι το ID του σχολίου που ξεκίνησε αυτή τη συνομιλία.

`broadcastId` (string, required) είναι ένα UUID για συγχρονισμό σε πραγματικό χρόνο ώστε να αποφεύγονται εφέ ηχούς.

#### Απόκριση

Η απόκριση περιλαμβάνει την κατάσταση του API και το ID της νεοδημιουργημένης συνομιλίας.

#### Παράδειγμα αιτήματος

```bash
curl -X POST "https://fastcomments.com/comment-image-chats/demo" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "urlId": "my-product-image",
    "windowUrlId": "my-product-image:/images/product.jpg:25.5:30.2",
    "pageTitle": "Product Gallery",
    "src": "/images/product.jpg",
    "x": 25.5,
    "y": 30.2,
    "createdFromCommentId": "comment789",
    "broadcastId": "550e8400-e29b-41d4-a716-446655440000"
  }'
```

#### Παράδειγμα απόκρισης

```json
{
  "status": "success",
  "createdChatId": "conv789"
}
```

### Διαγραφή συνομιλίας

Διαγράψτε μια υπάρχουσα συνομιλία εικόνας. Αυτό το endpoint απαιτεί δικαιώματα διαχειριστή ή moderator, ή η συνομιλία πρέπει να έχει δημιουργηθεί από τον αυθεντικοποιημένο χρήστη.

#### Endpoint

```
DELETE /comment-image-chats/:tenantId/:chatId
```

#### Παράμετροι

`tenantId` (παράμετρος διαδρομής, υποχρεωτική) είναι το FastComments Tenant ID σας.

`chatId` (παράμετρος διαδρομής, υποχρεωτική) είναι το ID της συνομιλίας που θέλετε να διαγράψετε.

`broadcastId` (σώμα αιτήματος, υποχρεωτικό) είναι ένα UUID για συγχρονισμό σε πραγματικό χρόνο.

#### Παράδειγμα αιτήματος

```bash
curl -X DELETE "https://fastcomments.com/comment-image-chats/demo/conv789" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "broadcastId": "550e8400-e29b-41d4-a716-446655440001"
  }'
```

#### Παράδειγμα απόκρισης

```json
{
  "status": "success"
}
```

### Σύστημα συντεταγμένων

Οι συντεταγμένες X και Y αποθηκεύονται ως ποσοστά του μεγέθους της εικόνας. Η X αντιπροσωπεύει τη οριζόντια θέση από την αριστερή άκρη (0 = αριστερή άκρη, 100 = δεξιά άκρη). Η Y αντιπροσωπεύει την κατακόρυφη θέση από την κορυφή (0 = κορυφή, 100 = κάτω μέρος).

Αυτές οι τιμές ποσοστού μπορούν να περιλαμβάνουν δεκαδικά για ακρίβεια. Για παράδειγμα, x: 25.5 σημαίνει 25.5% από το αριστερό άκρο της εικόνας.

### Περιορισμός ρυθμού

Αυτά τα endpoints υπόκεινται στον τυπικό περιορισμό ρυθμού (rate limiting) του FastComments API. Το middleware περιορισμού ρυθμού εφαρμόζεται ανά tenant για να αποτρέπει καταχρήσεις επιτρέποντας ταυτόχρονα κανονικά πρότυπα χρήσης.

### Απαντήσεις σφάλματος

Όλα τα endpoints επιστρέφουν τα τυπικά HTTP status codes. Μια απόκριση 400 υποδεικνύει μη έγκυρες παραμέτρους αιτήματος. Μια απόκριση 401 σημαίνει αποτυχία αυθεντικοποίησης. Μια απόκριση 403 υποδεικνύει ανεπαρκή δικαιώματα. Μια απόκριση 404 σημαίνει ότι η συνομιλία δεν βρέθηκε. Μια απόκριση 429 υποδεικνύει ότι ξεπεράστηκε το όριο ρυθμού.

Οι απαντήσεις σφάλματος περιλαμβάνουν ένα JSON σώμα με λεπτομέρειες:

```json
{
  "status": "error",
  "message": "Conversation not found"
}
```

### Παρακολούθηση χρήσης

Η δημιουργία συνομιλιών αυξάνει το μετρικό χρήσης `conversationCreateCount`. Όλη η δραστηριότητα συγχρονισμού WebSocket αυξάνει τα `pubSubMessageCount` και `pubSubBandwidth`. Μπορείτε να παρακολουθείτε αυτά τα μετρικά στο ταμπλό του FastComments στην ενότητα ανάλυσης χρήσης.