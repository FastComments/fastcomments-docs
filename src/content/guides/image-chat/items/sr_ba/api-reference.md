### Pregled API-ja

Image Chat пружа три REST API крајње тачке за програмско управљање конверзацијама везаним за слике. Ове крајње тачке омогућавају да преузмете, креирате и бришете маркере без коришћења widget-а у прегледнику.

Све API крајње тачке захтевају аутентификацију и прате стандардне FastComments API обрасце. Ово су јавне крајње тачке које се аутентификују путем колачића у прегледнику, а не API кључева.

### Основни URL

Све Image Chat API крајње тачке се налазе на:

```
https://fastcomments.com/comment-image-chats
```

### Аутентикација

Ове крајње тачке аутентификују кориснике путем колачића у прегледнику. Оне не користе API кључеве. Корисници морају бити пријављени на FastComments у свом прегледнику да би приступили овим крајњим тачкама.

### Преузимање свих конверзација

Дohватите све конверзације везане за слику за одређену слику.

#### Крајња тачка

```
GET /comment-image-chats/:tenantId?urlId=<urlId>
```

#### Параметри

`tenantId` (параметар пута, обавезно) је ваш FastComments Tenant ID.

`urlId` (параметар упита, обавезно) је идентификатор слике за коју желите да преузмете конверзације.

#### Одговор

Одговор садржи статус API-ја, информације о тренутној корисничкој сесији ако је аутентификована, низ конверзација са њиховим ID-јевима, URL-овима и X/Y координатама, очишћени идентификатор URL-а, ознаку која показује да ли је тренутни корисник администратор сајта или модератор, и детаље везе за WebSocket за синхронизацију уживо укључујући `tenantIdWS`, `urlIdWS`, и `userIdWS`.

#### Пример захтева

```bash
curl "https://fastcomments.com/comment-image-chats/demo?urlId=my-product-image" \
  --cookie "your-session-cookie"
```

#### Пример одговора

```json
{
  "status": "success",
  "user": {
    "id": "user123",
    "username": "john_doe"
  },
  "conversations": [
    {
      "_id": "conv123",
      "urlId": "my-product-image:/images/product.jpg:25:30",
      "x": 25.5,
      "y": 30.2
    },
    {
      "_id": "conv456",
      "urlId": "my-product-image:/images/product.jpg:60:45",
      "x": 60.8,
      "y": 45.1
    }
  ],
  "urlIdClean": "my-product-image",
  "isSiteAdmin": false,
  "tenantIdWS": "demo",
  "urlIdWS": "my-product-image",
  "userIdWS": "user123"
}
```

### Креирање конверзације

Креирајте нову конверзацију везану за слику за одређену позицију на слици.

#### Крајња тачка

```
POST /comment-image-chats/:tenantId
```

#### Параметри

`tenantId` (параметар пута, обавезно) је ваш FastComments Tenant ID.

Тело захтева мора бити JSON и садржати следећа обавезна поља.

`urlId` (string, обавезно) је основни идентификатор странице.

`windowUrlId` (string, обавезно) је URL комбинован са извором слике и координатама, на пример `my-page:/images/photo.jpg:25.5:30.2`.

`pageTitle` (string, обавезно) је наслов странице.

`src` (string, обавезно) је URL извора слике.

`x` (number, обавезно) је X координата као проценат (0-100).

`y` (number, обавезно) је Y координата као проценат (0-100).

`createdFromCommentId` (string, обавезно) је ID коментара који је иницирао овај разговор.

`broadcastId` (string, обавезно) је UUID за синхронизацију уживо како би се спречили ефекти одјека.

#### Одговор

Одговор садржи статус API-ја и ID новокреиране конверзације.

#### Пример захтева

```bash
curl -X POST "https://fastcomments.com/comment-image-chats/demo" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "urlId": "my-product-image",
    "windowUrlId": "my-product-image:/images/product.jpg:25.5:30.2",
    "pageTitle": "Product Gallery",
    "src": "/images/product.jpg",
    "x": 25.5,
    "y": 30.2,
    "createdFromCommentId": "comment789",
    "broadcastId": "550e8400-e29b-41d4-a716-446655440000"
  }'
```

#### Пример одговора

```json
{
  "status": "success",
  "createdChatId": "conv789"
}
```

### Брисање конверзације

Обришите постојећу конверзацију везану за слику. Ова крајња тачка захтева дозволе администратора или модератора, или конверзација мора бити креирана од стране аутентификованог корисника.

#### Крајња тачка

```
DELETE /comment-image-chats/:tenantId/:chatId
```

#### Параметри

`tenantId` (параметар пута, обавезно) је ваш FastComments Tenant ID.

`chatId` (параметар пута, обавезно) је ID конверзације која се брише.

`broadcastId` (тело захтева, обавезно) је UUID за синхронизацију уживо.

#### Пример захтева

```bash
curl -X DELETE "https://fastcomments.com/comment-image-chats/demo/conv789" \
  --cookie "your-session-cookie" \
  -H "Content-Type: application/json" \
  -d '{
    "broadcastId": "550e8400-e29b-41d4-a716-446655440001"
  }'
```

#### Пример одговора

```json
{
  "status": "success"
}
```

### Систем координата

X и Y координате се чувају као проценти димензија слике. X представља хоризонталну позицију од леве ивице (0 = лева ивица, 100 = десна ивица). Y представља вертикалну позицију од горње ивице (0 = горња ивица, 100 = доња ивица).

Ове процентуалне вредности могу садржати децимале за већу прецизност. На пример, x: 25.5 значи 25.5% од леве ивице слике.

### Ограничење броја захтева

Ове крајње тачке су подложне стандардном ограничењу броја захтева FastComments API-ја. Middleware за ограничење брзине примењује се по tenant-у како би спречио злоупотребу, а допуштао уобичајене обрасце коришћења.

### Одговори о грешкама

Све крајње тачке враћају стандардне HTTP статусне кодове. Одговор 400 означава неважеће параметре захтева. Одговор 401 значи да аутентификација није успела. Одговор 403 означава недовољне дозволе. Одговор 404 значи да конверзација није пронађена. Одговор 429 означава прелазак ограничења брзине.

Одговори са грешкама укључују JSON тело са детаљима:

```json
{
  "status": "error",
  "message": "Conversation not found"
}
```

### Праћење коришћења

Креирање конверзација повећава вашу метрику коришћења `conversationCreateCount`. Сва активност синхронизације преко WebSocket-а повећава `pubSubMessageCount` и `pubSubBandwidth`. Можете пратити ове метрике на вашој FastComments контролној табли у одељку аналитике коришћења.

---