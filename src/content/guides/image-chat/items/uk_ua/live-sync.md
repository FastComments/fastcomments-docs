### Оновлення в режимі реального часу

Image Chat використовує WebSocket-з’єднання для синхронізації всіх розмов у режимі реального часу між усіма підключеними користувачами. Коли хтось створює нову мітку, додає коментар або видаляє обговорення, усі інші користувачі, які переглядають те саме зображення, бачать оновлення миттєво без оновлення сторінки.

### How WebSocket Sync Works

Коли ви ініціалізуєте Image Chat, віджет встановлює WebSocket-з’єднання з серверами FastComments. Це з’єднання залишається відкритим протягом сеансу користувача і прослуховує оновлення, що стосуються поточного зображення.

Система WebSocket використовує три типи широкомовних повідомлень для Image Chat. Подія `new-image-chat` спрацьовує, коли хтось створює нову мітку на зображенні. Подія `image-chat-updated` спрацьовує, коли хтось оновлює існуючу розмову. Подія `deleted-image-chat` спрацьовує, коли хтось видаляє мітку.

### Broadcast ID System

Щоб запобігти ефекту ехо, коли користувачі бачать свої власні дії, що транслюються назад до них, кожне оновлення включає унікальний `broadcastId`. Коли користувач створює або оновлює мітку, його клієнт генерує UUID для цієї операції. Коли WebSocket транслює оновлення назад усім клієнтам, початковий клієнт ігнорує це оновлення, оскільки воно відповідає його власному `broadcastId`.

Це забезпечує плавну взаємодію, коли користувачі бачать свої зміни негайно в інтерфейсі користувача без очікування кругового проходження через сервер, одночасно забезпечуючи, що всі інші користувачі отримують оновлення.

### Connection Resilience

Якщо WebSocket-з’єднання припиняється через мережеві проблеми або технічне обслуговування сервера, віджет автоматично намагається повторно підключитися. Під час періоду повторного підключення користувачі все ще можуть взаємодіяти з існуючими мітками, але вони не бачитимуть оновлень від інших користувачів у режимі реального часу, поки з’єднання не буде відновлено.

Після відновлення з’єднання віджет повторно синхронізується, щоб переконатися, що ні одне оновлення не було пропущено. Це відбувається прозоро без необхідності втручання користувача.

### Bandwidth Considerations

Повідомлення WebSocket є легкими і містять лише необхідну інформацію для синхронізації стану. Створення нової мітки зазвичай використовує менше ніж 1KB пропускної здатності. Система також включає інтелектуальне пакетування, щоб зменшити частоту повідомлень під час періодів високої активності.

Ваші метрики використання в панелі керування FastComments відстежують `pubSubMessageCount` і `pubSubBandwidth`, щоб ви могли контролювати активність синхронізації в реальному часі на ваших сайтах.

### Cross-Tab Synchronization

Якщо користувач має ту ж сторінку відкритою в кількох вкладках браузера, оновлення в одній вкладці відображаються негайно в інших вкладках. Це працює через той самий механізм синхронізації WebSocket і не вимагає додаткової конфігурації.

Користувачі можуть мати ваш сайт відкритим на кількох пристроях одночасно, і всі вони залишатимуться синхронізованими. Мітка, створена на настільному комп’ютері, з’явиться миттєво на планшеті користувача, якщо обидва пристрої переглядають те саме зображення.

### Security

Повідомлення WebSocket передаються через захищені з’єднання (WSS) і включають tenant validation, щоб гарантувати, що користувачі отримують лише ті оновлення для розмов, на які вони мають дозвіл. Сервер перевіряє всі операції перед їх широкомовленням, щоб запобігти несанкціонованому доступу або маніпуляціям.

### Offline Behavior

Коли користувачі повністю офлайн, вони все ще можуть переглядати існуючі мітки, але не можуть створювати нові або бачити оновлення від інших. Віджет виявляє стан офлайн і відображає відповідні повідомлення.

Якщо користувач намагається створити мітку в офлайн-режимі, а потім повертається в мережу, операція зазнає невдачі замість того, щоб поставитися в чергу, що забезпечує узгодженість даних. Користувачам слід повторити операцію після відновлення з’єднання.

### Performance Impact

WebSocket-з’єднання має мінімальний вплив на продуктивність. З’єднання залишається в режимі простою, коли оновлень не відбувається, і обробляє повідомлення лише під час активності. На типовому зображенні з помірною активністю міток WebSocket використовує менше CPU, ніж рендеринг самого зображення.

Для сторінок з сотнями одночасних користувачів і високою активністю створення міток система масштабується по горизонталі, щоб підтримувати продуктивність без впливу на індивідуальні клієнтські з’єднання.

### Collaborative Use Cases

Синхронізація в режимі реального часу робить Image Chat особливо потужним для спільної роботи. Команди дизайнерів можуть разом переглядати макети, при цьому всі бачать розміщення міток у режимі реального часу. Команди підтримки клієнтів можуть спільно коментувати скриншоти, щоб виявити проблеми. Освітні групи можуть обговорювати діаграми, причому всі учасники бачать мітки один одного під час їх створення.

Негайний зворотний зв’язок створює більш залучений і продуктивний досвід співпраці порівняно з традиційними системами коментарів, де користувачам потрібно оновлювати сторінку, щоб побачити оновлення.