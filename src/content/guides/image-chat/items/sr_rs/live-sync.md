### Ажурирања у реалном времену

Image Chat користи WebSocket везе за синхронизацију свих разговора у реалном времену међу свим повезаним корисницима. Када неко креира нови маркер, дода коментар или обрише дискусију, сви остали корисници који гледају исту слику виде ажурирање одмах без освежавања.

### Како функционише WebSocket синхронизација

Када иницијализујете Image Chat, видгет успоставља WebSocket везу са FastComments серверима. Та веза остаје отворена током трајања сесије корисника и слуша ажурирања везана за текућу слику.

WebSocket систем користи три типа broadcast порука за Image Chat. Догађај `new-image-chat` се покреће када неко креира нови маркер на слици. Догађај `image-chat-updated` се покреће када неко ажурира постојећи разговор. Догађај `deleted-image-chat` се покреће када неко обрише маркер.

### Систем Broadcast ID

Да би се спречили ефекти одјека где корисници виде своје акције како им се шаљу назад, свако ажурирање садржи јединствени `broadcastId`. Када корисник креира или ажурира маркер, његов клијент генерише UUID за ту операцију. Када WebSocket емитује ажурирање назад свим клијентима, оригинални клијент игнорише то ажурирање јер се поклапа са његовим `broadcastId`.

Ово обезбеђује глатку интеракцију у којој корисници виде своје измене одмах у UI без чекања путања тамо-натраг преко сервера, уз истовремено обезбеђивање да сви остали корисници добију ажурирање.

### Отпорност везе

Ако WebSocket веза падне због мрежних проблема или одржавања сервера, видгет аутоматски покушава поновно повезивање. Током периода поновног повезивања, корисници и даље могу да интерактују са постојећим маркерима, али неће видети ажурирања у реалном времену од других корисника све док веза не буде поново успостављена.

Када је веза поново успостављена, видгет поново синхронизује да би се осигурало да нису пропуштена ажурирања. То се дешава транспарентно без потребе за интервенцијом корисника.

### Разматрања о пропусном опсегу

WebSocket поруке су лаки и садрже само основне информације потребне за синхронизацију стања. Креирање новог маркера обично користи мање од 1KB пропусног опсега. Систем такође укључује интелигентно груписање (batching) како би смањио фреквенцију порука током периода велике активности.

Ваше метрике коришћења у FastComments контролној табли прате `pubSubMessageCount` и `pubSubBandwidth` тако да можете пратити активност синхронизације у реалном времену на вашим сајтовима.

### Синхронизација између табова

Ако корисник има исту страницу отворену у више прегледачких табова, ажурирања у једном табу појављују се одмах у осталим табовима. Ово ради кроз исти WebSocket механизам синхронизације и не захтева додатну конфигурацију.

Корисници могу имати ваш сајт отворен на више уређаја истовремено, и сви ће остати синхронизовани. Маркер креиран на десктоп рачунару појављује се одмах на корисниковом таблету ако оба уређаја гледају исту слику.

### Безбедност

WebSocket поруке се преносе преко сигурних веза (WSS) и садрже валидацију тенанта како би се осигурало да корисници примају само ажурирања за разговоре које су овлашћени да виде. Сервер валида све операције пре него што их емитује како би спречио неовлашћен приступ или манипулацију.

### Понашање у офлајну режиму

Када су корисници потпуно ван мреже, и даље могу да прегледају постојеће маркере, али не могу да креирају нове или виде ажурирања од других. Видгет детектује офлајн стање и приказује одговарајуће поруке.

Ако корисник покуша да креира маркер док је офлајн, а затим се врати на мрежу, операција ће пропасти уместо да се стави у ред, чиме се обезбеђује конзистентност података. Корисници би требало поново да покушају операцију када им се веза обнови.

### Утицај на перформансе

WebSocket веза има минималан утицај на перформансе. Веза остаје неактивна када нема ажурирања и обрађује поруке само када дође до активности. На типичној слици са умереном активношћу маркера, WebSocket користи мање CPU него само рендеровање слике.

За странице са стотинама истовремених корисника и високом активношћу креирања маркера, систем се хоризонтално скалира да одржи перформансе без утицаја на појединачне клијентске везе.

### Сценарији за колаборативно коришћење

Синхронизација у реалном времену чини Image Chat посебно моћним за колаборативне токове рада. Дизајн тимови могу заједно прегледати макете, где сви виде постављање маркера у реалном времену. Тимови корисничке подршке могу заједно означавати снимке екрана да би идентификовали проблеме. Едукативне групе могу дискутовати о дијаграмима при чему сви учесници виде маркере једни других како се креирају.

Одмах повратна информација ствара занимљивије и продуктивније колаборативно искуство у поређењу са традиционалним системима коментара где корисници морају да освежe страницу да би видели ажурирања.