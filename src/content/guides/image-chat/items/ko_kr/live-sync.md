### Real-Time Updates

Image Chat은 모든 연결된 사용자 간에 모든 대화를 실시간으로 동기화하기 위해 WebSocket 연결을 사용합니다. 누군가 새로운 마커를 생성하거나 댓글을 추가하거나 토론을 삭제하면 동일한 이미지를 보고 있는 다른 모든 사용자는 새로 고침 없이 즉시 업데이트를 확인합니다.

### How WebSocket Sync Works

Image Chat을 초기화하면 위젯이 FastComments 서버에 WebSocket 연결을 설정합니다. 이 연결은 사용자의 세션 동안 열려 있으며 현재 이미지와 관련된 업데이트를 수신 대기합니다.

WebSocket 시스템은 Image Chat을 위해 세 가지 유형의 브로드캐스트 메시지를 사용합니다. `new-image-chat` 이벤트는 누군가 이미지에 새 마커를 생성할 때 발생합니다. `image-chat-updated` 이벤트는 누군가 기존 대화를 업데이트할 때 발생합니다. `deleted-image-chat` 이벤트는 누군가 마커를 삭제할 때 발생합니다.

### Broadcast ID System

사용자가 자신의 작업이 다시 자신에게 브로드캐스트되어 에코 효과가 발생하는 것을 방지하기 위해 각 업데이트에는 고유한 `broadcastId`가 포함됩니다. 사용자가 마커를 생성하거나 업데이트할 때 클라이언트는 해당 작업에 대해 UUID를 생성합니다. WebSocket이 업데이트를 모든 클라이언트에 다시 브로드캐스트할 때, 원래 작업을 수행한 클라이언트는 자신의 `broadcastId`와 일치하므로 해당 업데이트를 무시합니다.

이렇게 하면 사용자는 서버를 통한 왕복을 기다리지 않고도 UI에서 변경 사항을 즉시 볼 수 있으면서 다른 모든 사용자에게는 업데이트가 전달되도록 하여 원활한 상호작용을 보장합니다.

### Connection Resilience

네트워크 문제나 서버 유지보수로 인해 WebSocket 연결이 끊기면 위젯은 자동으로 재연결을 시도합니다. 재연결 기간 동안 사용자는 기존 마커와 상호작용할 수 있지만 연결이 복구될 때까지 다른 사용자의 실시간 업데이트는 볼 수 없습니다.

재연결이 완료되면 위젯은 누락된 업데이트가 없도록 다시 동기화합니다. 이 작업은 사용자의 개입 없이 투명하게 발생합니다.

### Bandwidth Considerations

WebSocket 메시지는 경량이며 상태 동기화에 필요한 핵심 정보만 포함합니다. 새 마커를 생성하는 데 일반적으로 1KB 미만의 대역폭이 사용됩니다. 시스템은 또한 활동이 많은 기간 동안 메시지 빈도를 줄이기 위해 지능형 배칭을 포함합니다.

FastComments 대시보드의 사용량 지표는 `pubSubMessageCount` 및 `pubSubBandwidth`를 추적하므로 사이트 전반의 실시간 동기화 활동을 모니터링할 수 있습니다.

### Cross-Tab Synchronization

사용자가 동일한 페이지를 여러 브라우저 탭에서 연 경우 한 탭의 업데이트가 다른 탭에 즉시 표시됩니다. 이는 동일한 WebSocket 동기화 메커니즘을 통해 작동하며 추가 구성이 필요하지 않습니다.

사용자는 여러 기기에서 동시에 사이트를 열어둘 수 있으며 모든 기기가 동기 상태를 유지합니다. 데스크탑에서 생성된 마커는 두 기기 모두 동일한 이미지를 보고 있는 경우 사용자의 태블릿에 즉시 표시됩니다.

### Security

WebSocket 메시지는 보안 연결(WSS)을 통해 전송되며, 사용자가 권한이 있는 대화에 대해서만 업데이트를 받도록 테넌트 검증이 포함됩니다. 서버는 브로드캐스트하기 전에 모든 작업을 검증하여 무단 액세스나 조작을 방지합니다.

### Offline Behavior

사용자가 완전히 오프라인인 경우 기존 마커는 여전히 볼 수 있지만 새 마커를 생성하거나 다른 사용자의 업데이트를 볼 수는 없습니다. 위젯은 오프라인 상태를 감지하고 적절한 메시지를 표시합니다.

사용자가 오프라인 상태에서 마커를 생성하려 시도한 후 온라인으로 돌아오면 해당 작업은 큐에 보관되는 대신 실패합니다. 이는 데이터 일관성을 보장하기 위함입니다. 사용자는 연결이 복원된 후 작업을 다시 시도해야 합니다.

### Performance Impact

WebSocket 연결은 성능에 미치는 영향이 최소입니다. 업데이트가 발생하지 않을 때 연결은 유휴 상태를 유지하며 활동이 발생할 때만 메시지를 처리합니다. 중간 수준의 마커 활동이 있는 일반적인 이미지의 경우 WebSocket은 이미지 자체를 렌더링하는 것보다 적은 CPU를 사용합니다.

수백 명이 동시에 접속하고 마커 생성 활동이 많은 페이지의 경우 시스템은 개별 클라이언트 연결에 영향을 주지 않으면서 성능을 유지하도록 수평적으로 확장됩니다.

### Collaborative Use Cases

실시간 동기화는 Image Chat을 공동 작업 워크플로에 특히 강력하게 만듭니다. 디자인 팀은 모두가 마커 배치를 실시간으로 보면서 목업을 함께 검토할 수 있습니다. 고객 지원 팀은 문제를 식별하기 위해 스크린샷에 공동으로 주석을 달 수 있습니다. 교육 그룹은 모든 참가자가 생성되는 각자의 마커를 보면서 다이어그램을 토론할 수 있습니다.

즉각적인 피드백은 사용자가 업데이트를 보기 위해 새로 고침해야 하는 전통적인 댓글 시스템에 비해 더 몰입감 있고 생산적인 협업 경험을 만듭니다.