### רכיבים נדרשים

עבור On-Prem, FastComments מורכב רק משרת אפליקציה וממאגר נתונים. פישרנו את הפריסה כך שהאפליקציה יכולה לשרת את כל התעבורה ישירות מבלי להוסיף רכיבים אחרים.

שרת האפליקציה מסופק בתמונת Docker וניתן לפרוס אותו עם כל פתרון ניהול קונטיינרים.

ממאגר הנתונים, MongoDB, ניתן להפעיל בעצמכם או לארח אצל ספק אחר כמו AWS DocumentDB או MongoDB Atlas.

FastComments נבדק כרגע עם MongoDB 7, אולם אנו שואפים להתאים גם ל-DocumentDB כדי להקל על הפריסה.

### מידות מופעים

תגלו ש-FastComments מותאם די טוב ואינו דורש מכונות גדולות לאפליקציה עצמה כדי לשמור על P99s נמוכים.

כל עבודות ה-batch וה-cron משתמשות בזרימה (streaming) כדי להגביל את השימוש הכולל בזיכרון.

הטבלאות שלמטה עבור שרת האפליקציה ומאגר הנתונים יכולות לסייע בקביעת גודל המופעים.

### מופעי שרת אפליקציה


| Concurrent Users | Total Cluster CPUs | Total Cluster Memory |
|------------------|--------------------|----------------------|
| 100              | 1                  | 256mb                |
| 1K               | 2                  | 512mb                |
| 10K              | 8                  | 1gb                  |
| 100K             | 32                 | 8gb                  |
| 1M               | 64                 | 64gb                 |

למשל, ליבה בודדת שמשרתת כ-100 שרשורים של תגובות בשנייה בדרך כלל לעולם לא צורכת יותר מ-250mb RSS.

### מופעי שרת מאגר נתונים

גיזום (sizing) של מאגר הנתונים תלוי בגודל ה-working set, שהוא כמות הנתונים שאתם ניגשים אליה בנקודת זמן נתונה, וכן בבקשות בו-זמנית.

FastComments יחסית ידידותי ל-Mongo, בכך שעבור השאילתות החמות הוא משתמש ברמזי אינדקס, ב-cursors זורמים, ויש לו הגבלות תחרותיות באזורים שונים כדי למנוע עומס יתר על מערכות משניות.

להלן קו מנחה כללי לגבי מידות מופעי מאגר הנתונים. **שים לב שזה __לכל מופע__, לא משאבים כוללים באשכול**.

| Concurrent Users | Comments Stored | CPUs Per Instance | Memory Per Instance |
|------------------|-----------------|-------------------|---------------------|
| 100              | 1k              | 1                 | 256mb               |
| 1K               | 5k              | 2                 | 512mb               |
| 10K              | 100k            | 8                 | 2gb                 |
| 100K             | 500k            | 16                | 8gb                 |
| 1M               | 5M              | 32                | 32gb                |

הטבלאות שלעיל הן הערכות שמרניות. ייתכן שתגלו שהדרישות בפועל שונות בהתאם לתצורה הספציפית שלכם (גדלי עמודים, נפח תגובות וכו').