### Required Components

Для локального развёртывания (On-Prem) FastComments состоит лишь из сервера приложения и базы данных. Мы упростили развёртывание так, чтобы приложение могло обслуживать весь трафик напрямую без добавления других компонентов.

Сервер приложения предоставляется в Docker-образе и может быть развернут с любым решением для управления контейнерами.

База данных, MongoDB, может запускаться самостоятельно или размещаться у другого провайдера, например AWS DocumentDB или MongoDB Atlas.

FastComments в настоящее время тестируется с MongoDB 7, однако мы стремимся к совместимости с DocumentDB для упрощения развёртывания.

### Instance Sizes

Вы увидите, что FastComments довольно хорошо оптимизирован и не требует крупных машин для самого приложения, чтобы поддерживать низкие P99s.

Все пакетные и cron-задачи используют стриминг для ограничения общего использования памяти.

Ниже приведённые таблицы для сервера приложения и базы данных могут помочь с подбором размеров.

### Application Server Instances


| Concurrent Users | Total Cluster CPUs | Total Cluster Memory |
|------------------|--------------------|----------------------|
| 100              | 1                  | 256mb                |
| 1K               | 2                  | 512mb                |
| 10K              | 8                  | 1gb                  |
| 100K             | 32                 | 8gb                  |
| 1M               | 64                 | 64gb                 |

Например, одно ядро, обслуживающее около 100 потоков комментариев в секунду, как правило, никогда не использует более 250mb RSS.

### Database Server Instances

Подбор размеров базы данных зависит от размера рабочего набора (working set size), то есть объёма данных, к которым вы обращаетесь в данный момент времени, а также от количества одновременных запросов.

FastComments довольно бережно относится к Mongo: для горячих запросов используются подсказки индекса (index hints), стриминговые курсоры и имеются лимиты конкурентности в различных областях, чтобы предотвратить перегрузку downstream-систем.

Ниже приведено общее руководство по размерам инстансов базы данных. **Обратите внимание, что это __на каждый инстанс__, а не суммарные ресурсы в кластере**.

| Concurrent Users | Comments Stored | CPUs Per Instance | Memory Per Instance |
|------------------|-----------------|-------------------|---------------------|
| 100              | 1k              | 1                 | 256mb               |
| 1K               | 5k              | 2                 | 512mb               |
| 10K              | 100k            | 8                 | 2gb                 |
| 100K             | 500k            | 16                | 8gb                 |
| 1M               | 5M              | 32                | 32gb                |

Приведённые выше таблицы являются консервативными оценками. Вы можете обнаружить, что фактические требования отличаются в зависимости от вашей конкретной конфигурации (размеры страниц, объём комментариев и т.д.).