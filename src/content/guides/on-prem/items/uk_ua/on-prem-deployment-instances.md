### Необхідні компоненти

Для On-Prem, FastComments складається лише з серверу застосунку та бази даних. Ми спростили розгортання так, щоб застосунок міг обслуговувати весь трафік без додавання інших компонентів.

Сервер застосунку постачається у Docker image і може бути розгорнутий з будь-яким рішенням для керування контейнерами.

Базу даних, MongoDB, можна запускати самостійно або використовувати хостинг від іншого провайдера, наприклад AWS DocumentDB або MongoDB Atlas.

FastComments наразі тестується з MongoDB 7, проте ми прагнемо забезпечити сумісність з DocumentDB для полегшення розгортання.

### Розміри інстансів

Ви побачите, що FastComments досить добре оптимізований і не вимагає потужних машин для самого застосунку, щоб підтримувати низькі P99s.

Усі пакетні та cron-завдання використовують потокову обробку, щоб обмежити загальне використання пам'яті.

Нижченаведені таблиці для серверу застосунку та бази даних допоможуть з визначенням розмірів.

### Інстанси серверу застосунку


| Одночасні користувачі | Загальна кількість CPU у кластері | Загальна пам'ять кластера |
|-----------------------|-----------------------------------|---------------------------|
| 100                   | 1                                 | 256mb                    |
| 1K                    | 2                                 | 512mb                    |
| 10K                   | 8                                 | 1gb                      |
| 100K                  | 32                                | 8gb                      |
| 1M                    | 64                                | 64gb                     |

Наприклад, одне ядро, що обслуговує близько 100 тредів коментарів за секунду, зазвичай ніколи не використовує більше ніж 250mb RSS.

### Інстанси серверу бази даних

Визначення розміру бази даних залежить від розміру робочого набору (working set) — кількості даних, до яких ви звертаєтесь у певний момент часу, а також від одночасних запитів.

FastComments досить «дружній» до Mongo: для гарячих запитів він використовує index hints, streaming cursors і має concurrency limits у різних ділянках, щоб запобігти перевантаженню підсистем.

Нижченаведене — загальна орієнтовна таблиця розмірів інстансів бази даних. **Зверніть увагу, що це __на один інстанс__, а не загальні ресурси кластера**.

| Одночасні користувачі | Збережено коментарів | CPU на інстанс | Пам'ять на інстанс |
|-----------------------|----------------------|----------------|--------------------|
| 100                   | 1k                   | 1              | 256mb              |
| 1K                    | 5k                   | 2              | 512mb              |
| 10K                   | 100k                 | 8              | 2gb                |
| 100K                  | 500k                 | 16             | 8gb                |
| 1M                    | 5M                   | 32             | 32gb               |

Вищенаведені таблиці — консервативні оцінки. Ви можете виявити, що фактичні вимоги відрізняються в залежності від вашої конкретної конфігурації (розміри сторінок, обсяг коментарів тощо).

---