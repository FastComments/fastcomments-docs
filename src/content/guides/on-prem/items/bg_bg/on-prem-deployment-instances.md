### Необходими компоненти

За On-Prem, FastComments се състои само от сървър на приложението и база данни. Опростихме разгръщането, така че приложението може да обслужва целия трафик директно, без добавяне на други компоненти.

Сървърът на приложението се предоставя като Docker изображение и може да се разположи с всяко решение за управление на контейнери.

Базата данни, MongoDB, може да се управлява самостоятелно или да се хоства от друг доставчик като AWS DocumentDB или MongoDB Atlas.

FastComments в момента е тестван с MongoDB 7, но целим да бъдем съвместими с DocumentDB, за да улесним разгръщането.

### Размери на инстанциите

Ще установите, че FastComments е доста оптимизиран и не изисква големи машини за самото приложение, за да поддържа ниски P99s.

Всички пакетни и cron задачи използват стрийминг, за да ограничат общото използване на памет.

По-долу таблиците за сървъра на приложението и базата данни могат да помогнат при оразмеряването.

### Инстанции на сървъра на приложението


| Едновременни потребители | Общо CPU на клъстера | Обща памет на клъстера |
|--------------------------|----------------------|------------------------|
| 100                      | 1                    | 256mb                 |
| 1K                       | 2                    | 512mb                 |
| 10K                      | 8                    | 1gb                   |
| 100K                     | 32                   | 8gb                   |
| 1M                       | 64                   | 64gb                  |

Например, едно ядро, обслужващо около 100 нишки с коментари в секунда, обикновено никога не използва повече от 250mb RSS.

### Инстанции на сървъра на базата данни

Оразмеряването на базата данни зависи от размера на работния набор, който е количеството данни, до които имате достъп в даден момент, както и от едновременните заявки.

FastComments е сравнително щадящ към Mongo, тъй като за горещите заявки използва index hints, streaming cursors и има concurrency limits в различни области, за да предотврати претоварване на downstream системите.

По-долу е общо ръководство за размерите на инстанциите на базата данни. **Обърнете внимание, че това е __за всеки екземпляр__, а не общите ресурси в клъстера**.

| Едновременни потребители | Съхранени коментари | CPU на инстанция | Памет на инстанция |
|-------------------------|---------------------|------------------|--------------------|
| 100                     | 1k                  | 1                | 256mb              |
| 1K                      | 5k                  | 2                | 512mb              |
| 10K                     | 100k                | 8                | 2gb                |
| 100K                    | 500k                | 16               | 8gb                |
| 1M                      | 5M                  | 32               | 32gb               |

Горните таблици са консервативни оценки. Може да установите, че действителните изисквания се различават в зависимост от вашата конкретна конфигурация (размери на страници, обем на коментари и др.).