---
### Требуемые компоненты

Для On-Prem, FastComments состоит только из сервера приложения и базы данных. Мы упростили развёртывание так, чтобы приложение могло обслуживать весь трафик напрямую без добавления других компонентов.

Сервер приложения предоставляется в Docker-образе и может быть развернут с любой системой управления контейнерами.

База данных, MongoDB, может запускаться самостоятельно или размещаться у другого провайдера, такого как AWS DocumentDB или MongoDB Atlas.

FastComments в настоящее время тестируется с MongoDB 7, однако мы стремимся обеспечить совместимость с DocumentDB для упрощения развёртывания.

### Размеры инстансов

Вы увидите, что FastComments довольно хорошо оптимизирован и не требует больших машин для самого приложения, чтобы поддерживать низкие P99s.

Все пакетные и cron-задачи используют потоковую обработку, чтобы ограничить общее потребление памяти.

Ниже приведённые таблицы для сервера приложения и базы данных помогут с подбором размеров.

### Экземпляры сервера приложения


| Одновременных пользователей | Всего CPU кластера | Общая память кластера |
|-----------------------------|--------------------|-----------------------|
| 100                         | 1                  | 256mb                 |
| 1K                          | 2                  | 512mb                 |
| 10K                         | 8                  | 1gb                   |
| 100K                        | 32                 | 8gb                   |
| 1M                          | 64                 | 64gb                  |

Например, одно ядро, обслуживающее около 100 веток комментариев в секунду, обычно не использует более 250mb RSS.

### Экземпляры сервера базы данных

Размер базы данных зависит от размера рабочего набора, то есть объёма данных, к которым вы обращаетесь в определённый момент времени, а также от количества одновременных запросов.

FastComments довольно бережно относится к Mongo: для «горячих» запросов он использует подсказки индекса, потоковые курсоры и имеет ограничения параллелизма в различных областях, чтобы предотвратить перегрузку downstream-систем.

Ниже приведена общая рекомендация по размерам экземпляров базы данных. **Обратите внимание, что это __на экземпляр__, а не суммарные ресурсы в кластере**.

| Одновременных пользователей | Хранимых комментариев | CPU на экземпляр | Память на экземпляр |
|-----------------------------|----------------------|------------------|---------------------|
| 100                         | 1k                   | 1                | 256mb               |
| 1K                          | 5k                   | 2                | 512mb               |
| 10K                         | 100k                 | 8                | 2gb                 |
| 100K                        | 500k                 | 16               | 8gb                 |
| 1M                          | 5M                   | 32               | 32gb                |

Приведённые выше таблицы — консервативные оценки. Вы можете обнаружить, что фактические требования отличаются в зависимости от вашей конкретной конфигурации (размеры страниц, объём комментариев и т. п.).
---