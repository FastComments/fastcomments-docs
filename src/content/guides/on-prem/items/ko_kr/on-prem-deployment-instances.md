### 필수 구성 요소

온프레미스(온프렘) 환경의 경우, FastComments는 애플리케이션 서버와 데이터베이스로만 구성됩니다. 애플리케이션이 다른 구성 요소를 추가하지 않고 모든 트래픽을 직접 처리할 수 있도록 배포를 단순화했습니다.

애플리케이션 서버는 Docker 이미지로 제공되며 어떤 컨테이너 관리 솔루션으로도 배포할 수 있습니다.

데이터베이스인 MongoDB는 직접 운영할 수 있고 AWS DocumentDB나 MongoDB Atlas와 같은 다른 제공업체에서 호스팅할 수도 있습니다.

FastComments는 현재 MongoDB 7에서 테스트되고 있으며, 배포를 용이하게 하기 위해 DocumentDB 호환성을 목표로 하고 있습니다.

### 인스턴스 크기

FastComments는 상당히 최적화되어 있어 애플리케이션 자체는 낮은 P99를 유지하기 위해 큰 머신을 필요로 하지 않는다는 것을 알게 될 것입니다.

모든 배치 및 cron 작업은 총 메모리 사용량을 제한하기 위해 스트리밍을 사용합니다.

아래의 애플리케이션 서버 및 데이터베이스 표는 크기 결정을 도와줍니다.

### 애플리케이션 서버 인스턴스


| 동시 사용자 | 총 클러스터 CPU 수 | 총 클러스터 메모리 |
|------------------|--------------------|----------------------|
| 100              | 1                  | 256mb                |
| 1K               | 2                  | 512mb                |
| 10K              | 8                  | 1gb                  |
| 100K             | 32                 | 8gb                  |
| 1M               | 64                 | 64gb                 |

예를 들어, 초당 약 100개의 댓글 스레드를 처리하는 단일 코어는 보통 250mb RSS를 넘지 않습니다.

### 데이터베이스 서버 인스턴스

데이터베이스 크기 산정은 작업 집합 크기(특정 시점에 액세스하는 데이터 양)와 동시 요청 수에 따라 달라집니다.

FastComments는 Mongo에 대해 비교적 친절한 편으로, 핫 쿼리에는 인덱스 힌트(index hints), 스트리밍 커서(streaming cursors)를 사용하고 다운스트림 시스템의 과부하를 방지하기 위해 여러 영역에서 동시성 제한을 적용합니다.

아래는 데이터베이스 인스턴스 크기에 대한 일반적인 가이드라인입니다. **참고: 이것은 __인스턴스당__ 리소스이며, 클러스터의 총 리소스가 아닙니다.**

| 동시 사용자 | 저장된 댓글 수 | 인스턴스당 CPU 수 | 인스턴스당 메모리 |
|------------------|-----------------|-------------------|---------------------|
| 100              | 1k              | 1                 | 256mb               |
| 1K               | 5k              | 2                 | 512mb               |
| 10K              | 100k            | 8                 | 2gb                 |
| 100K             | 500k            | 16                | 8gb                 |
| 1M               | 5M              | 32                | 32gb                |

위 표는 보수적인 추정치입니다. 실제 요구 사항은 페이지 크기, 댓글량 등 특정 구성에 따라 다를 수 있습니다.